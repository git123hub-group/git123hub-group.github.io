function functiongraphMain(){this.version="1.08",w=570,h=510,graphLt=0,graphTp=0,graphWd=550,graphHt=340,coords=new Coords(graphLt,graphTp,graphWd,graphHt,-5,-3,5,3,!0),canvasWd=graphWd,canvasHt=graphHt,clrs=["darkblue","orange"];var t="";t+='<div style="position:relative; width:'+w+"px; height:"+h+'px; border-radius: 10px;  margin:auto; display:block; background-color: #ddeeff; ">',t+='<div style="position:absolute; left:50px; top:6px; color:'+clrs[0]+'; font: bold 20px Arial; width:96%; z-index: 2;">y =</div>',t+='<input type="text" id="f0" style="position:absolute; left:90px; top:6px; color:'+clrs[0]+'; background-color: #eeffee; text-align:center; font: bold 20px Arial; width:420px; border-radius: 10px;  z-index: 2;" value="" onKeyUp="doGraph()" />',t+='<div style="position:absolute; left:50px; top:36px; color:'+clrs[1]+'; font: bold 20px Arial; width:96%; z-index: 2;">y =</div>',t+='<input type="text" id="f1" style="position:absolute; left:90px; top:36px; color:'+clrs[1]+'; background-color: #eeffee; text-align:center; font: bold 20px Arial; width:420px; border-radius: 10px;  z-index: 2;" value="" onKeyUp="doGraph()" />',t+='<div style="position:absolute; left:135px; top:68px; color:black; font: 13px Arial; z-index: 2;">缩放:</div>',t+='<input type="range" id="r1"  value="0.5" min="0" max="1" step=".01"  style="z-index:2; position:absolute; top:66px; left:170px; width:200px; height:17px; border: none; " oninput="onZoomChg(0,this.value)" onchange="onZoomChg(1,this.value)" />',t+='<button style="font: 12px Arial; position:absolute; left:380px; top:66px;" class="togglebtn"  onclick="zoomReset()" >重置</button>',t+='<canvas id="canvasId" width="'+canvasWd+'" height="'+canvasHt+'" style="position:absolute; left:5px; top:22px; z-index:1; margin-top: 70px; margin-left: 5px; background-color: #ffffff; border: 1px solid black;"></canvas>',t+='<button id="polarBtn" style="font: 16px Arial; position:absolute; left:3px; bottom:23px;" class="togglebtn lo"  onclick="polarClick()" >极坐标</button>',t+='<div id="aval" style="position:absolute; left:265px; bottom:39px; color:black; font: bold 17px Arial; z-index: 2; text-align: : center;">1</div>',t+='<div style="position:absolute; left:160px; bottom:25px; color:black; font: bold 13px Arial; z-index: 2;">a:</div>',t+='<input type="range" id="ra" value="1" min="0" max="2" step=".001"  style="z-index:2; position:absolute; left:170px; bottom:23px; width:200px; height:17px; border: none; " oninput="onaChg(0,this.value)" onchange="onaChg(1,this.value)" />',t+='<button style="font: 16px Arial; position:absolute; right:120px; bottom:33px;" class="togglebtn"  onclick="linkPop()" >链接</button>',t+='<button style="font: 16px Arial; position:absolute; right:64px; bottom:33px;" class="togglebtn"  onclick="printCanvas()" >打印</button>',t+='<button style="font: 16px Arial; position:absolute; right:3px; bottom:33px;" class="togglebtn"  onclick="saveCanvas()" >保存</button>',t+='<button style="font: 16px Arial; position:absolute; right:3px; bottom:3px;" class="togglebtn"  onclick="doExample()" >例子</button>',t+='<div id="linkpop" style="position:absolute; left:-450px; top:240px; padding: 5px; border: 1px solid red; border-radius: 9px; background-color: #88aaff; box-shadow: 10px 10px 5px 0px rgba(40,40,40,0.75); z-index:1; transition: all linear 0.3s; opacity:0; ">',t+='<textarea  id="linkbox" value="ddd" style="width: 400px; height: 120px; font: 16px Arial; border: 1px solid red; border-radius: 9px; background-color: #eeeeff; display: block;">',t+="</textarea >",t+='<div style="float:right; margin: 0 0 5px 10px;">',t+='<button onclick="linkPopClose()" style="z-index:2; font: 22px Arial;" class="togglebtn" >&#x2714;</button>',t+="</div>",t+="</div>",t+='<div id="copyrt" style="font: bold 10px Arial; color: #6600cc; position:absolute; left:5px; bottom:3px;">&copy; 2015 MathsIsFun.com  v'+this.version+"</div>",t+="</div>",document.write(t),el=document.getElementById("canvasId"),ratio=3,el.width=canvasWd*ratio,el.height=canvasHt*ratio,el.style.width=canvasWd+"px",el.style.height=canvasHt+"px",g=el.getContext("2d"),g.setTransform(ratio,0,0,ratio,0,0),g.translate(.5,.5),examples=["tan(x)/x","(x-1)(x+1)","2x","e^x"],exampleNo=0,currZoom=1,polarQ=!1,aVal=1;var e=getQueryVariable("func1");e&&(e=decodeURIComponent(e),document.getElementById("f0").value=e),e=getQueryVariable("func2"),e&&(e=decodeURIComponent(e),document.getElementById("f1").value=e),(e=getQueryVariable("xmin"))&&(coords.xStt=parseFloat(e)),(e=getQueryVariable("xmax"))&&(coords.xEnd=parseFloat(e)),(e=getQueryVariable("ymin"))&&(coords.yStt=parseFloat(e)),(e=getQueryVariable("ymax"))&&(coords.yEnd=parseFloat(e)),coords.calcScale(),parser=new Parser,dragging=!1,downX=0,downY=0,prevX=0,prevY=0,el.addEventListener("mousedown",mouseDownListener,!1),window.addEventListener("mousemove",mouseMoveListener,!1),window.addEventListener("mouseup",mouseUpListener,!1),el.addEventListener("touchstart",ontouchstart,!1),window.addEventListener("touchmove",ontouchmove,!1),window.addEventListener("touchend",ontouchend,!1),doGraph()}function linkPop(){var t=document.getElementById("linkpop");t.style.transitionDuration="0.3s",t.style.opacity=1,t.style.zIndex=12,t.style.left="100px",document.getElementById("linkbox").value=makeURL()}function makeURL(){var t="https://git123hub.github.io/function-grapher.html?",e=document.getElementById("f0").value;e.length>0&&(t+="func1="+encodeURIComponent(e)+"&");var s=document.getElementById("f1").value;return s.length>0&&(t+="func2="+encodeURIComponent(s)+"&"),t+="xmin="+coords.xStt.toPrecision(4)+"&",t+="xmax="+coords.xEnd.toPrecision(4)+"&",t+="ymin="+coords.yStt.toPrecision(4)+"&",t+="ymax="+coords.yEnd.toPrecision(4)+"&",t=t.substr(0,t.length-1)}function linkPopClose(){var t=document.getElementById("linkpop");t.style.opacity=0,t.style.zIndex=1,t.style.left="-500px"}function onaChg(t,e){aVal=e;var s=document.getElementById("aval");s.innerHTML=e,s.style.left=170+100*e+"px",doGraph()}function polarClick(){polarQ=!polarQ,toggleBtn("polarBtn",polarQ),doGraph()}function toggleBtn(t,e){e?(document.getElementById(t).classList.add("hi"),document.getElementById(t).classList.remove("lo")):(document.getElementById(t).classList.add("lo"),document.getElementById(t).classList.remove("hi"))}function zoomReset(){coords=new Coords(graphLt,graphTp,graphWd,graphHt,-5,-3,5,3,!0),doGraph()}function doExample(){exampleNo=++exampleNo%examples.length,document.getElementById("f1").value=examples[exampleNo],doGraph()}function ontouchstart(t){var e=t.targetTouches[0];t.clientX=e.clientX,t.clientY=e.clientY,t.touchQ=!0,mouseDownListener(t)}function ontouchmove(t){var e=t.targetTouches[0];t.clientX=e.clientX,t.clientY=e.clientY,t.touchQ=!0,mouseMoveListener(t),t.preventDefault()}function ontouchend(t){dragging=!1}function mouseDownListener(t){var e=el.getBoundingClientRect(),s=(t.clientX-e.left)*(el.width/ratio/e.width),i=(t.clientY-e.top)*(el.height/ratio/e.height);return downX=s,downY=i,prevX=s,prevY=i,dragging=!0,t.preventDefault?t.preventDefault():t.returnValue&&(t.returnValue=!1),!1}function mouseUpListener(t){var e=el.getBoundingClientRect(),s=(t.clientX-e.left)*(el.width/ratio/e.width),i=(t.clientY-e.top)*(el.height/ratio/e.height);Math.abs(s-downX)<2&&Math.abs(i-downY)<2&&(coords.newCenter(s,i),doGraph()),dragging=!1}function mouseMoveListener(t){var e=el.getBoundingClientRect(),s=(t.clientX-e.left)*(el.width/ratio/e.width),i=(t.clientY-e.top)*(el.height/ratio/e.height);if(dragging){var o=prevX-s,a=i-prevY;(Math.abs(o)>1||Math.abs(a)>1)&&(coords.drag(o,a),doGraph(),prevX=s,prevY=i)}}function onZoomChg(t,e){var s=(2*e+.01)/currZoom;coords.scale(s),currZoom*=s,1==t&&(currZoom=1,document.getElementById("r1").value=.5),doGraph()}function drawPlot(t,e){switch(e=null,t){case"implicit":drawNewton(1);break;case"newton2":drawNewton(2);break;case"signchange":drawImplicitSign(2,t);break;case"shaded":drawShaded(2,t)}var s,i,o=!0,a=-1,r=-1,n=9;switch(t){case"xy":case"dydx":s=0,i=coords.width;break;case"polar":var h=0,d=4,l=6.2832*h,c=6.2832*d;x=Math.min(Math.max(600,250*(d-h)),3e3),f=(c-l)/x,0==f&&(f=1),s=Math.floor(l/f),i=Math.ceil(c/f);break;case"para":var p=0,u=3,x=Math.min(Math.max(600,250*(u-p)),3e3),f=(u-p)/x;0==f&&(f=1),s=Math.floor(p/f),i=Math.ceil(u/f)}for(var y=[],v=Number.NEGATIVE_INFINITY,b=Number.NEGATIVE_INFINITY,m=1/coords.xScale,w=0;i>=w;w++){var S,k,M,E;switch(t){case"xy":M=w,S=coords.xStt+M*coords.xScale,parser.setVarVal("x",S),k=parser.getVal(),E=coords.toYPix(k,!1);break;case"dydx":M=w,S=coords.xStt+M*coords.xScale,parser.setVarVal("x",S);var N=parser.getVal();k=(N-b)*m,b=N;break;case"polar":var P=w*f;parser.setVarVal("x",P);var I=parser.getVal();S=I*Math.cos(P),k=I*Math.sin(P);break;case"para":M=w;var L=coords.xStt+M*coords.xScale,A=conicVals(L);S=A[0],k=A[1],this.vals.b>1.1?-.95>k&&k>-1.05&&(pt1[0]=A[0],pt1[1]=A[1]):k<.7*-this.vals.b&&k>.8*-this.vals.b&&(pt1[0]=A[0],pt1[1]=A[1])}var C=o;o=!1;var Q=n;n=0,k<coords.yStt&&(n=-1),k>coords.yEnd&&(n=1),k==Number.NEGATIVE_INFINITY&&(n=-1,k=coords.yStt-10*coords.yScale),k==Number.POSITIVE_INFINITY&&(n=1,k=coords.yEnd+10*coords.yScale),o=Q*n!=0,isNaN(k)&&(n=9,o=!0),("polar"==t||"para"==t)&&(S=Math.min(Math.max(coords.xStt-10*coords.xScale,S),coords.xEnd+10*coords.xScale),M=(S-coords.xStt)/coords.xScale),k=Math.min(Math.max(coords.yStt-10*coords.yScale,k),coords.yEnd+10*coords.yScale),E=(coords.yEnd-k)/coords.yScale,o?C||9>n&&y.push([M,E]):C?9>Q?(y.push(0),y.push([a,r]),y.push([M,E])):(y.push(0),y.push([M,E])):y.push([M,E]),v=S,a=M,r=E}var V=!0;g.beginPath();for(var Y=0,T=y.length;T>Y;Y++){var X=y[Y];0==X?(g.stroke(),V=!0):V?(g.beginPath(),g.moveTo(X[0],X[1]),V=!1):g.lineTo(X[0],X[1])}g.stroke()}function doGraph(){g.clearRect(0,0,el.width,el.height);var t=new Graph(g,coords);t.drawGraph();for(var e=((new Date).getTime(),0);2>e;e++){var s=document.getElementById("f"+e).value;s.length>0&&(s=s.substr(0,1e3),parser.radiansQ=this.radQ,parser.setVarVal("a",aVal),parser.newParse(s),g.strokeStyle=clrs[e],g.lineWidth=1.5,drawPlot(polarQ?"polar":"xy"))}(new Date).getTime();g.fillStyle="#000000",g.strokeStyle="#000000",g.font="bold 14px Verdana",g.textAlign="center";for(var i=[],e=0;e<i.length;e++){var o=i[e];o>=coords.xStt&&o<coords.xEnd&&(g.fillText(o.toPrecision(5),coords.toXPix(o),coords.toYPix(0)-10),g.beginPath(),g.arc(coords.toXPix(o),coords.toYPix(0),5,0,2*Math.PI),g.stroke())}}function fmt(t,e){return e=14,t==Number.POSITIVE_INFINITY?"undefined":t==Number.NEGATIVE_INFINITY?"undefined":(t=t.toPrecision(e),t=t.replace(/0+$/,""),"."==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),Math.abs(t)<1e-15&&(t=0),t)}function fixParentheses(t){for(var e=0,s=0,i=0;i<t.length;i++)"("==t.charAt(i)&&e++,")"==t.charAt(i)&&s++;for(;s>e;)t="("+t,e++;for(;e>s;)t+=")",s++;return t}function Pt(t,e){this.x=t,this.y=e}function Coords(t,e,s,i,o,a,r,n,h){this.left=t,this.top=e,this.width=s,this.height=i,this.xStt=o,this.yStt=a,this.xEnd=r,this.yEnd=n,this.uniScaleQ=h,this.xLogQ=!1,this.yLogQ=!1,this.calcScale()}function Graph(t,e){this.g=t,this.coords=e,this.xLinesQ=!0,this.yLinesQ=!0,this.xValsQ=!0,this.yValsQ=!0,this.skewQ=!1}function Parser(){this.operators="+-*(/),^.",this.rootNode,this.tempNode=[],this.Variable="x",this.errMsg="",this.radiansQ=!0,this.vals=[];for(var t=0;26>t;t++)this.vals[t]=0;this.reset()}function MathNode(t,e,s){this.tREAL=0,this.tVAR=1,this.tOP=2,this.tFUNC=3,this.radiansQ=!0,this.setNew(t,e,s)}function factorial(t){if(0>t)return NaN;if(2>t)return 1;t<<=0;var e;e=t;for(var s=t;e-- >2;)s*=e;return s}function isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}function getQueryVariable(t){for(var e=window.location.search.substring(1),s=e.split("&"),i=0;i<s.length;i++){var o=s[i].split("=");if(o[0]==t)return o[1]}return!1}function saveCanvas(){var t=document.getElementById("canvasId");window.open(t.toDataURL("image/png"))}function printCanvas(){var t=document.getElementById("canvasId").toDataURL(),e="<!DOCTYPE html>";e+="<html>",e+="<head><title>打印画布</title></head>",e+="<body>",e+='<img src="'+t+'">',e+="</body>",e+="</html>";var s=window.open("","","width=340,height=260");s.document.open(),s.document.write(e),s.document.close(),s.focus(),s.print(),s.close()}function dist(t,e){return Math.sqrt(t*t+e*e)}Coords.prototype.calcScale=function(){this.xLogQ&&(this.xStt<=0&&(this.xStt=1),this.xEnd<=0&&(this.xEnd=1)),this.yLogQ&&(this.yStt<=0&&(this.yStt=1),this.yEnd<=0&&(this.yEnd=1));var t;this.xStt>this.xEnd&&(t=this.xStt,this.xStt=this.xEnd,this.xEnd=t),this.yStt>this.yEnd&&(t=this.yStt,this.yStt=this.yEnd,this.yEnd=t);var e=this.xEnd-this.xStt;0>=e&&(e=1e-9),this.xScale=e/this.width,this.xLogScale=(Math.log(this.xEnd)-Math.log(this.xStt))/this.width;var s=this.yEnd-this.yStt;if(0>=s&&(s=1e-9),this.yScale=s/this.height,this.yLogScale=(Math.log(this.yEnd)-Math.log(this.yStt))/this.height,this.uniScaleQ&&!this.xLogQ&&!this.yLogQ){var i=Math.max(this.xScale,this.yScale);this.xScale=i,e=this.xScale*this.width;var o=(this.xStt+this.xEnd)/2;this.xStt=o-e/2,this.xEnd=o+e/2,this.yScale=i,s=this.yScale*this.height;var a=(this.yStt+this.yEnd)/2;this.yStt=a-s/2,this.yEnd=a+s/2}},Coords.prototype.scale=function(t,e,s){void 0===e&&(e=(this.xStt+this.xEnd)/2),this.xStt=e-(e-this.xStt)*t,this.xEnd=e+(this.xEnd-e)*t,void 0===s&&(s=(this.yStt+this.yEnd)/2),this.yStt=s-(s-this.yStt)*t,this.yEnd=s+(this.yEnd-s)*t,this.calcScale()},Coords.prototype.drag=function(t,e){this.xStt+=t*this.xScale,this.xEnd+=t*this.xScale,this.yStt+=e*this.yScale,this.yEnd+=e*this.yScale,this.calcScale()},Coords.prototype.newCenter=function(t,e){var s=this.xStt+t*this.xScale,i=(this.xEnd-this.xStt)/2;this.xStt=s-i,this.xEnd=s+i;var o=this.yEnd-e*this.yScale,a=(this.yEnd-this.yStt)/2;this.yStt=o-a,this.yEnd=o+a,this.calcScale()},Coords.prototype.fitToPts=function(t,e){for(var s=0;s<t.length;s++){var i=t[s];0==s?(this.xStt=i.x,this.xEnd=i.x,this.yStt=i.y,this.yEnd=i.y):(this.xStt=Math.min(this.xStt,i.x),this.xEnd=Math.max(this.xEnd,i.x),this.yStt=Math.min(this.yStt,i.y),this.yEnd=Math.max(this.yEnd,i.y))}var o=(this.xStt+this.xEnd)/2,a=e*(this.xEnd-this.xStt)/2;this.xStt=o-a,this.xEnd=o+a;var r=(this.yStt+this.yEnd)/2,n=e*(this.yEnd-this.yStt)/2;this.yStt=r-n,this.yEnd=r+n,this.calcScale()},Coords.prototype.toXPix=function(t,e){return this.xLogQ?this.left+(Math.log(t)-Math.log(xStt))/this.xLogScale:this.left+(t-this.xStt)/this.xScale},Coords.prototype.toYPix=function(t){return this.yLogQ?this.top+(Math.log(yEnd)-Math.log(t))/this.yLogScale:this.top+(this.yEnd-t)/this.yScale},Coords.prototype.toPtVal=function(t,e){return new Pt(this.toXVal(t.x,e),this.toYVal(t.y,e))},Coords.prototype.toXVal=function(t,e){return e?this.xStt+(t-this.left)*this.xScale:this.xStt+t*this.xScale},Coords.prototype.toYVal=function(t,e){return e?yEnd-(t-top)*this.yScale:yEnd-t*this.yScale},Coords.prototype.getTicks=function(t,e,s){var i=[],o=this.tickInterval(e/s,!1),a=Math.ceil(t/o)*o,r=0,n=t+e;do{var h=a+r*o;h=+h.toPrecision(8),i.push([h,1]),r++}while(n>h);for(o=this.tickInterval(e/s,!0),r=0;r<i.length;r++){var d=i[r][0];Math.abs(Math.round(d/o)-d/o)<.001&&(i[r][1]=0)}return i},Coords.prototype.tickInterval=function(t,e){var s=Math.pow(10,Math.floor(Math.log(t)*Math.LOG10E)),i=t/s;return i>=5?e?5*s:1*s:i>=3?e?2*s:.2*s:i>=1.4?e?.5*s:.2*s:i>=.8?e?.5*s:.1*s:e?.2*s:.1*s},Graph.prototype.drawGraph=function(){this.hzAxisY=coords.toYPix(0),this.hzAxisY<0&&(this.hzAxisY=0),this.hzAxisY>coords.height&&(this.hzAxisY=coords.height),this.hzNumsY=this.hzAxisY+14,this.hzAxisY>coords.height-10&&(this.hzNumsY=coords.height-3),this.vtAxisX=coords.toXPix(0),this.vtAxisX<0&&(this.vtAxisX=0),this.vtAxisX>coords.width&&(this.vtAxisX=coords.width),this.vtNumsX=this.vtAxisX-5,this.vtAxisX<10&&(this.vtNumsX=20),coords.xLogQ?this.drawLinesLogX():this.xLinesQ&&this.drawHzLines(),coords.yLogQ?this.drawLinesLogY():this.yLinesQ&&this.drawVtLines()},Graph.prototype.drawVtLines=function(){var t=this.g;t.lineWidth=1;for(var e=coords.getTicks(coords.xStt,coords.xEnd-coords.xStt,graphWd/100),s=0;s<e.length;s++){var i=e[s],o=i[0],a=i[1];0==a?t.strokeStyle="rgba(0,0,256,0.3)":t.strokeStyle="rgba(0,0,256,0.1)";var r=coords.toXPix(o,!1);t.beginPath(),t.moveTo(r,coords.toYPix(coords.yStt,!1)),t.lineTo(r,coords.toYPix(coords.yEnd,!1)),t.stroke(),0==a&&this.xValsQ&&(t.fillStyle="#0000ff",t.font="bold 12px Verdana",t.textAlign="center",t.fillText(""+o,r,this.hzNumsY))}this.skewQ||(t.lineWidth=1.5,t.strokeStyle="#ff0000",t.beginPath(),t.moveTo(this.vtAxisX,coords.toYPix(coords.yStt,!1)),t.lineTo(this.vtAxisX,coords.toYPix(coords.yEnd,!1)),t.stroke(),t.beginPath(),t.fillStyle=t.strokeStyle,t.drawArrow(this.vtAxisX,coords.toYPix(coords.yEnd),15,2,20,10,Math.PI/2,10,!1),t.stroke(),t.fill())},Graph.prototype.drawHzLines=function(){var t=this.g;t.lineWidth=1;for(var e=coords.getTicks(coords.yStt,coords.yEnd-coords.yStt,graphHt/100),s=0;s<e.length;s++){var i=e[s],o=i[0],a=i[1];0==a?t.strokeStyle="rgba(0,0,256,0.3)":t.strokeStyle="rgba(0,0,256,0.1)";var r=coords.toYPix(o,!1);t.beginPath(),t.moveTo(coords.toXPix(coords.xStt,!1),r),t.lineTo(coords.toXPix(coords.xEnd,!1),r),t.stroke(),0==a&&this.yValsQ&&(t.fillStyle="#ff0000",t.font="bold 12px Verdana",t.textAlign="right",t.fillText(""+o,this.vtNumsX,r+5))}this.skewQ||(t.lineWidth=2,t.strokeStyle="#0000ff",t.beginPath(),t.moveTo(coords.toXPix(coords.xStt,!1),this.hzAxisY),t.lineTo(coords.toXPix(coords.xEnd,!1),this.hzAxisY),t.stroke(),t.beginPath(),t.fillStyle=t.strokeStyle,t.drawArrow(coords.toXPix(coords.xEnd,!1),this.hzAxisY,15,2,20,10,0,10,!1),t.stroke(),t.fill())},Parser.prototype.setVarVal=function(t,e){switch(t){case"x":this.vals[23]=e;break;case"y":this.vals[24]=e;break;case"z":this.vals[25]=e;break;default:1==t.length&&(this.vals[t.charCodeAt(0)-"a".charCodeAt(0)]=e)}},Parser.prototype.getVal=function(){return this.rootNode.walk(this.vals)},Parser.prototype.newParse=function(t){this.reset(),t=t.split(" ").join(""),t=t.split("÷").join("/"),t=t.split("[").join("("),t=t.split("]").join(")"),t=t.replace(/\u2212/g,"-"),t=t.replace(/\u00F7/g,"/"),t=t.replace(/\u00D7/g,"*"),t=t.replace(/\u00B2/g,"^2"),t=t.replace(/\u00B3/g,"^3"),t=t.replace(/\u221A/g,"sqrt"),t=this.fixParentheses(t),t=this.fixUnaryMinus(t),t=this.fixImplicitMultply(t),this.rootNode=this.parse(t)},Parser.prototype.fixParentheses=function(t){for(var e=0,s=0,i=0;i<t.length;i++)"("==t.charAt(i)&&e++,")"==t.charAt(i)&&s++;for(;s>e;)t="("+t,e++;for(;e>s;)t+=")",s++;return t},Parser.prototype.fixUnaryMinus=function(t){for(var e=t+"\n",s="",i=!1,o="(",a="",r=0;r<t.length;r++){var n=t.charAt(r);if(n>="0"&&"9">=n?a="N":(a=this.operators.indexOf(n)>=0?"-"==n?"-":"O":"."==n||n==this.Variable?"N":"C","("==n&&(a="("),")"==n&&(a=")")),e+=a,"("==o&&"-"==a&&(s+="0"),i)switch(a){case"N":break;default:s+=")",i=!1}"O"==o&&"-"==a&&(s+="(0",i=!0),s+=n,o=a}return i&&(s+=")",i=!1),s},Parser.prototype.fixImplicitMultply=function(t){for(var e=t+"\n",s="",i="?",o="",a="?",r="",n=0;n<t.length;n++){var h=t.charAt(n);if(h>="0"&&"9">=h?a="N":(this.operators.indexOf(h)>=0?(a="O",r=""):(a="C",r+=h),"("==h&&(a="("),")"==h&&(a=")")),e+=a,"N"==i&&"C"==a&&(s+="*",r=""),"N"==i&&"("==a&&(s+="*"),")"==i&&"("==a&&(s+="*"),"("==a)switch(o){case"i":case"pi":case"e":case"a":case this.Variable:s+="*"}s+=h,i=a,o=r}return s},Parser.prototype.reset=function(){this.tempNode=[],this.errMsg=""},Parser.prototype.parse=function(t){if(""==t)return new MathNode("real","0",this.radiansQ);if(isNumeric(t))return new MathNode("real",t,this.radiansQ);if("$"==t.charAt(0)&&isNumeric(t.substr(1)))return this.tempNode[+t.substr(1)];var e=t.toLowerCase();if(1==e.length&&e>="a"&&"z">=e)return new MathNode("var",e,this.radiansQ);switch(e){case"pi":return new MathNode("var",e,this.radiansQ)}var s=t.lastIndexOf("(");if(s>-1){var i=t.indexOf(")",s);if(0>i)return this.errMsg+="Missing ')'\n",new MathNode("real","0",this.radiansQ);var o=!1;if(0==s)o=!1;else{var a=t.substr(s-1,1);o=this.operators.indexOf(a)<=-1}if(o){for(var r=-1,n=s-1;n>-1;n--){var h=this.operators.indexOf(t.substr(n,1));if(h>-1){r=n;break}}return p=new MathNode("func",t.substr(r+1,s-1-r),this.radiansQ),p.addchild(this.parse(t.substr(s+1,i-s-1))),this.tempNode.push(p),this.parse(t.substr(0,r+1)+"$"+(this.tempNode.length-1)+t.substr(i+1,t.length-i-1))}return this.tempNode.push(this.parse(t.substr(s+1,i-s-1))),this.parse(t.substr(0,s)+"$"+(this.tempNode.length-1)+t.substr(i+1,t.length-i-1))}var d,l=t.lastIndexOf("+"),c=t.lastIndexOf("-");if(l>-1||c>-1){if(l>c){d=l;var p=new MathNode("op","add",this.radiansQ);return p.addchild(this.parse(t.substr(0,d))),p.addchild(this.parse(t.substr(d+1,t.length-d-1))),p}return d=c,p=new MathNode("op","sub",this.radiansQ),p.addchild(this.parse(t.substr(0,d))),p.addchild(this.parse(t.substr(d+1,t.length-d-1))),p}return l=t.lastIndexOf("*"),c=t.lastIndexOf("/"),l>-1||c>-1?l>c?(d=l,p=new MathNode("op","mult",this.radiansQ),p.addchild(this.parse(t.substr(0,d))),p.addchild(this.parse(t.substr(d+1,t.length-d-1))),p):(d=c,p=new MathNode("op","div",this.radiansQ),p.addchild(this.parse(t.substr(0,d))),p.addchild(this.parse(t.substr(d+1,t.length-d-1))),p):(d=t.indexOf("^"),d>-1?(p=new MathNode("op","pow",this.radiansQ),p.addchild(this.parse(t.substr(0,d))),p.addchild(this.parse(t.substr(d+1,t.length-d-1))),p):isNumeric(t)?new MathNode("real",t,this.radiansQ):0==t.length?new MathNode("real","0",this.radiansQ):(this.errMsg+="'"+t+"' is not a number.\n",new MathNode("real","0",this.radiansQ)))},MathNode.prototype.setNew=function(t,e,s){switch(this.radiansQ=void 0!==s?s:!0,this.clear(),t){case"real":this.typ=this.tREAL,this.r=+e;break;case"var":this.typ=this.tVAR,this.v=e;break;case"op":this.typ=this.tOP,this.op=e;break;case"func":this.typ=this.tFUNC,this.op=e}return this},MathNode.prototype.clear=function(){this.r=1,this.v="",this.op="",this.child=[],this.childCount=0},MathNode.prototype.addchild=function(t){return this.child.push(t),this.childCount++,this.child[this.child.length-1]},MathNode.prototype.getLevelsHigh=function(){for(var t=0,e=0;e<this.childCount;e++)t=Math.max(t,this.child[e].getLevelsHigh());return t+1},MathNode.prototype.isLeaf=function(){return 0==this.childCount},MathNode.prototype.getLastBranch=function(){if(this.isLeaf())return null;for(var t=0;t<this.childCount;t++)if(!this.child[t].isLeaf())return this.child[t].getLastBranch();return this},MathNode.prototype.fmt=function(t){t=void 0!==t?t:!0;var e="";if(this.typ==this.tOP)switch(this.op.toLowerCase()){case"add":e="+";break;case"sub":e=t?"&minus;":"-";break;case"mult":e=t?"&times;":"x";break;case"div":e=t?"&divide;":"/";break;case"pow":e="^";break;default:e=this.op}return this.typ==this.tREAL&&(e=""+this.r),this.typ==this.tVAR&&(1==this.r?e=this.v:0!=this.r&&(e=this.r+this.v)),this.typ==this.tFUNC&&(e=this.op),e},MathNode.prototype.walkFmt=function(){var t=this.walkFmta(!0,"");return t=t.replace("Infinity","Undefined")},MathNode.prototype.walkFmta=function(t,e){var s="";if(this.childCount>0){var i=!1;"add"==this.op&&(i=!0),"sub"==this.op&&(i=!0),"div"==e&&(i=!0),t&&(i=!1),this.typ==this.tFUNC&&(i=!0),this.typ==this.tOP||(s+=this.fmt(!0)),i&&(s+="(");for(var o=0;o<this.childCount;o++)this.typ==this.tOP&&o>0&&(s+=this.fmt()),s+=this.child[o].walkFmta(!1,this.op),(this.typ==this.tFUNC||i&&o>0)&&(s+=")")}else s+=this.fmt(),("sin"==e||"cos"==e||"tan"==e)&&(s+=this.radiansQ?" rad":"&deg;");return s},MathNode.prototype.walkNodesFmt=function(t){for(var e="",s=0;t>s;s++)e+="|   ";for(e+=this.fmt(),e+="\n",s=0;s<this.childCount;s++)e+=this.child[s].walkNodesFmt(t+1);return e},MathNode.prototype.walk=function(t){if(this.typ==this.tREAL)return this.r;if(this.typ==this.tVAR)switch(this.v){case"x":return t[23];case"y":return t[24];case"z":return t[25];case"pi":return Math.PI;case"e":return Math.exp(1);case"a":return t[0];case"n":return t[13];default:return 0}if(this.typ==this.tOP){for(var e=0,s=0;s<this.childCount;s++){var i=0;if(null!=this.child[s]&&(i=this.child[s].walk(t)),0==s)e=i;else switch(this.op){case"add":e+=i;break;case"sub":e-=i;break;case"mult":e*=i;break;case"div":e/=i;break;case"pow":2==i?e*=e:e=Math.pow(e,i)}}return e}if(this.typ==this.tFUNC){var o=this.child[0].walk(t),a=1;switch(this.radiansQ||(a=180/Math.PI),this.op){case"sin":e=Math.sin(o/a);break;case"cos":e=Math.cos(o/a);break;case"tan":e=Math.tan(o/a);break;case"asin":e=Math.asin(o)*a;break;case"acos":e=Math.acos(o)*a;break;case"atan":e=Math.atan(o)*a;break;case"sinh":e=(Math.exp(o)-Math.exp(-o))/2;break;case"cosh":e=(Math.exp(o)+Math.exp(-o))/2;break;case"tanh":e=(Math.exp(o)-Math.exp(-o))/(Math.exp(o)+Math.exp(-o));break;case"exp":e=Math.exp(o);break;case"log":e=Math.log(o)*Math.LOG10E;break;case"ln":e=Math.log(o);break;case"abs":e=Math.abs(o);break;case"deg":e=180*o/Math.PI;break;case"rad":e=o*Math.PI/180;break;case"sign":e=0>o?-1:1;break;case"sqrt":e=Math.sqrt(o);break;case"round":e=Math.round(o);break;case"int":e=Math.floor(o);break;case"floor":e=Math.floor(o);break;case"ceil":e=Math.ceil(o);break;case"fact":e=factorial(o);break;default:e=NaN}return e}return e},CanvasRenderingContext2D.prototype.drawArrow=function(t,e,s,i,o,a,r,n,h){var d=this,l=[[0,0],[-o,-a/2],[-o+n,-i/2],[-s,-i/2],[-s,i/2],[-o+n,i/2],[-o,a/2],[0,0]];h&&l.push([0,-a/2],[-s,-a/2],[-s,a/2],[0,a/2]);for(var c=0;c<l.length;c++){var p=Math.cos(-r),u=Math.sin(-r),x=l[c][0]*p+l[c][1]*u,g=l[c][0]*u-l[c][1]*p;0==c?d.moveTo(t+x,e+g):d.lineTo(t+x,e+g)}},functiongraphMain();