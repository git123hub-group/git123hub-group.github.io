function parseFmt1(a){var b=new Date,c=b.getFullYear()+"/"+zpadd2(b.getMonth())+"/"+zpadd2(b.getDate()),d=zpadd2(b.getHours())+":"+zpadd2(b.getMinutes())+":"+zpadd2(b.getSeconds())+"."+zpadd3(b.getMilliseconds());return a.replace(/\$((?:\\[\s\S]|[^\\\$])*)\$/g,function(a,e){if(""===e)return"$";var f,g,h,j,i=e.match(/(.*?)(?::|$)/)[1],k=e.slice(i.length+1);if("~"!==i.charAt(0))j=variableList["var_"+i];else switch(i){case"~date":j=c;break;case"~expr":return execNumExpr(k.replace(/\s/g,""));case"~time":j=d;break;case"~rtime":j=b.getTime()-firstTime.getTime()+"";break;case"~random":j=""+(4294967296*Math.random()|0);break;case"~randr":var l=k.split(",");return+l[0]+Math.random()*(l[1]-l[0]+1)|0;case"~line":return"\n";case"~space":return" ";case"~tab":return"	";case"~cline":return+lineNum+ +k;case"~tline":return+significantLines+ +k}if(f=k.match(/^((?:\\[\s\S]|[^\\\=])*)=((?:\\[\s\S]|[^\\\=])*)$/))return g=f[1].replace(/\\([\s\S])/g,"$1"),h=f[2].replace(/\\([\s\S])/g,"$1"),j.split(g).join(h);if(f=k.match(/^(\w+):([\s\S]*)$/))switch(g=f[1],h=f[2].replace(/\\([\s\S])/g,"$1"),!0){case/\bfirst\b/.test(g):return j.indexOf(h);case/\blast\b/.test(g):return j.lastIndexOf(h)}if(f=k.match(/^(-?\d+)$/))return j.slice(f[1]);if(f=k.match(/^(-?\d+),(-?\d+)$/))return j.slice(f[1],f[2]);switch(k){case"rev":case"reverse":return esrever.reverse(j);case"len":case"length":return j.length;case"lower":return j.toLowerCase();case"upper":return j.toUpperCase();case"bin":return(+j>>>0).toString(2);case"chr":return String.fromCharCode(j);case"oct":return(+j>>>0).toString(8);case"hex":return(+j>>>0).toString(16);case"fbin":return parseInt(j,2);case"ord":return j.charCodeAt(0);case"foct":return parseInt(j,8);case"fhex":return parseInt(j,16);case"var":return variableList["var_"+j];case"fmt":return parseFmt1(j)}return j})}function cmpF(a,b,c){switch(a=a.toLowerCase()){case"==":case"equ":return b===c;case"!=":case"neq":return b!==c;case"<":case"lss":return c>b;case"<=":case"leq":return c>=b;case">":case"gtr":return b>c;case">=":case"geq":return b>=c}}function HTMLEscape(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function KernelStep(a){if(a=String(a).replace(/[\s\t\xa0\u3000]*/,""),":"===a.charAt(0)||"#"===a.charAt(0)||""===a)return void++lineNum;var d,b=a.match(/[A-Za-z0-9\-\_$]+(:[A-Za-z0-9\-\_$]*)?/)[0],c=b.split(":");c.length<2&&(c[1]="");var f,e=a.slice(b.length).replace(/\s/,"");switch(c[0]){case"write":switch(c[1]){case"cssf":e=parseFmt1("var_"+e),hout+='<span style="'+HTMLEscape(e)+'">',KernelStep(compiled[lineNum+1]),hout+="</span>";break;case"css":hout+='<span style="'+HTMLEscape(e)+'">',KernelStep(compiled[lineNum+1]),hout+="</span>";break;case"multi":for(var g=parseInt(e);g&&!(lineNum+1>=significantLines);)hout+=HTMLEscape(compiled[++lineNum]),--g;break;case"var":hout+=HTMLEscape(variableList["var_"+e]);break;case"format":hout+=HTMLEscape(parseFmt1(e));break;case"readln":hout+=HTMLEscape(compiled[e]);break;default:hout+=HTMLEscape(e)}++lineNum;break;case"writeln":switch(c[1]){case"format":hout+=HTMLEscape(parseFmt1(e))+"\n";break;case"readln":hout+=HTMLEscape(compiled[e])+"\n";break;case"multi":for(var g=parseInt(e);g&&!(lineNum+1>=significantLines);)hout+=HTMLEscape(compiled[++lineNum])+"\n",--g;break;default:hout+=HTMLEscape(e)+"\n"}++lineNum;break;case"alert":switch(breakpoint=!0,rframe=!1,c[1]){case"format":_calert(ptitle,parseFmt1(e));break;default:_calert(ptitle,e)}++lineNum;break;case"rem":++lineNum;break;case"clear":hout="",++lineNum;break;case"goto":switch(c[1]){case"abs":lineNum=+e;break;case"abs-last":lineNum=significantLines-e;break;case"rel":lineNum+=+e;break;default:lineNum=variableList["tag_"+e]}break;case"loop":f=e.match(/(\S*)\s*([\+\-]?)\s*([\s\S]*)/);var h;switch(f[2]){case"+":h=lineNum+ +f[3];break;case"-":h=lineNum-f[3];break;default:h=variableList["tag_"+f[3]]}switch(c[1]){case"inc":variableList["var_"+f[1]]++;break;case"call":return void(elseCon?lineNum++:(calls[++callsp]=lastIF,calls[++callsp]=lastIF,calls[++callsp]=!1,lineNum=variableList["tag_"+e]));default:variableList["var_"+f[1]]--}variableList["var_"+f[1]]?lineNum=h:++lineNum,variableList["var_"+f[1]]=""+variableList["var_"+f[1]];break;case"call":switch(c[1]){case"abs":calls[++callsp]=++lineNum,calls[++callsp]=lastIF,calls[++callsp]=elseCon,lineNum=+e;break;case"abs-last":calls[++callsp]=++lineNum,calls[++callsp]=lastIF,calls[++callsp]=elseCon,lineNum=significantLines-e;break;case"rel":calls[++callsp]=++lineNum,calls[++callsp]=lastIF,calls[++callsp]=elseCon,lineNum+=+e;break;case"ret":elseCon=calls[callsp--],lastIF=calls[callsp--],lineNum=calls[callsp--];break;default:calls[++callsp]=++lineNum,calls[++callsp]=lastIF,calls[++callsp]=elseCon,lineNum=variableList["tag_"+e]}break;case"cflag":switch(c[1]){case"set":flag=!0;break;case"clear":flag=!1;break;case"compl":flag=~flag;break;case"push":st1[++st1p]=flag;break;case"pop":flag=st1[st1p--];break;default:f=e.split(" "),flag=cmpF(f[1],f[0],f[2])}break;case"break":++lineNum,breakpoint=!0,rframe=!1;break;case"terminate":for(var i=1;4>=i;++i)$id("rb"+i).disabled=!0;breakpoint=!0,rframe=!1;break;case"nextf":++lineNum,breakpoint=!0,rframe=!0;break;case"execf":KernelStep(parseFmt1(e));break;case"set":var f=e.match(/^\s*([^=]*)\s*=([\s\S]*)$/)||[e,e,""];switch(c[1]){case"f":variableList["var_"+f[1]]=parseFmt1(f[2]);break;case"a":variableList["var_"+f[1]]=""+execNumExpr(f[2].replace(/\s/g,""));break;case"af":variableList["var_"+f[1]]=""+execNumExpr(parseFmt1(f[2]).replace(/\s/g,""));break;case"p":vnam1=f[1],_cprompt(ptitle,"text",f[2]),breakpoint=!0,rframe=!1;break;case"pf":vnam1=f[1],_cprompt(ptitle,"text",parseFmt1(f[2])),breakpoint=!0,rframe=!1;break;case"pw":vnam1=f[1],_cprompt(ptitle,"password",f[2]),breakpoint=!0,rframe=!1;break;case"pwf":vnam1=f[1],_cprompt(ptitle,"password",parseFmt1(f[2])),breakpoint=!0,rframe=!1;break;case"ln":/^\s*\d\s*$/.test(f[1])?compiled[+f[1]]=variableList["var_"+f[2]]:variableList["var_"+f[1]]=compiled[+f[2]];break;case"del":delete variableList["var_"+f[1]];break;case"push":st0[++st0p]=variableList["var_"+f[1]];break;case"pop":variableList["var_"+f[1]]=st0[st0p--];break;default:variableList["var_"+f[1]]=f[2]}++lineNum;break;case"title":switch(c[1]){case"":case"set":ptitle=e;break;case"push":st0[++st0p]=ptitle;break;case"pop":ptitle=st0[st0p--];break;default:ptitle=e}++lineNum;break;case"if":f=e.match(/(\S*)\s*(\S*)\s*(\S*)\s*([\s\S]*)/),d=cmpF(f[2],+parseFmt1(f[1]),+parseFmt1(f[3])),"not"===c[1]&&(d=!d),elseCon=!d,lastIF=lineNum,d?KernelStep(f[4]):++lineNum;break;case"if_str":f=e.match(/(\S*)\s*(\S*)\s*(\S*)\s*([\s\S]*)/),d=cmpF(f[2],parseFmt1(f[1]),parseFmt1(f[3])),"not"===c[1]&&(d=!d),elseCon=!d,lastIF=lineNum,d?KernelStep(f[4]):++lineNum;break;case"if_flag":d="not"===c[1]?!flag:flag,elseCon=!d,lastIF=lineNum,d?KernelStep(e):++lineNum;break;case"confirm":f=e.match(/("?)(.*?)\1(?:\s+([\s\S]*))?/),breakpoint=!0,rframe=!1,lastIF=lineNum,vnam1="not"===c[1],vnam2=f[3],_cconfirm(ptitle,f[2]);break;case"else":elseCon?(elseCon=!1,KernelStep(e)):++lineNum;break;default:alert("\u627e\u4e0d\u5230 "+c[0]+" \u6307\u4ee4"),console.error("\u627e\u4e0d\u5230 "+c[0]+" \u6307\u4ee4"),breakpoint=!0,rframe=!1}}var firstTime=new Date,elseCon=!1,lastIF,st1,st1p,flag,vnam1,vnam2,ptitle,zpadd2=function(a){return 10>a?"0"+a:a},zpadd3=function(a){return 10>a?"00"+a:100>a?"0"+a:a};