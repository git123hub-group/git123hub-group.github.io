function parseFmt1(a){var b=new Date,c=b.getFullYear()+"/"+zpadd2(b.getMonth())+"/"+zpadd2(b.getDate()),d=zpadd2(b.getHours())+":"+zpadd2(b.getMinutes())+":"+zpadd2(b.getSeconds())+"."+zpadd3(b.getMilliseconds());return a.replace(/\$((?:\\[\s\S]|[^\\\$])*)\$/g,function(a,e){if(""===e)return"$";var f,h,g=e.match(/(.*?)(?::|$)/)[1];if("~"!==g.charAt(0))h=variableList["var_"+g];else switch(g){case"~date":h=c;break;case"~time":h=d;break;case"~rtime":h=b.getTime()-firstTime.getTime()+"";break;case"~random":h=""+(4294967296*Math.random()|0);break;case"~line":return"\n";case"~space":return" ";case"~tab":return"	"}var i=e.slice(g.length+1);if(f=i.match(/^((?:\\[\s\S]|[^\\\=])*)=((?:\\[\s\S]|[^\\\=])*)$/)){var j=f[1].replace(/\\([\s\S])/g,"$1"),k=f[2].replace(/\\([\s\S])/g,"$1");return h.split(j).join(k)}return(f=i.match(/^(-?\d+)$/))?h.slice(f[1]):(f=i.match(/^(-?\d+),(-?\d+)$/))?h.slice(f[1],f[2]):(f=i.match(/^rev(erse)?$/))?esrever.reverse(h):(f=i.match(/^len(gth)?$/))?h.length:h})}function cmpF(a,b,c){switch(a=a.toLowerCase()){case"==":case"equ":return b===c;case"!=":case"neq":return b!==c;case"<":case"lss":return c>b;case"<=":case"leq":return c>=b;case">":case"gtr":return b>c;case">=":case"geq":return b>=c}}function HTMLEscape(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function KernelStep(a){if(a=String(a).replace(/[\s\t\xa0\u3000]*/,""),":"===a.charAt(0)||"#"===a.charAt(0)||""===a)return void++lineNum;var b=a.match(/[A-Za-z0-9\-\_$]+(:[A-Za-z0-9\-\_$]*)?/)[0],c=b.split(":");c.length<2&&(c[1]="");var d=a.slice(b.length+1);switch(c[0]){case"write":switch(c[1]){case"var":hout+=HTMLEscape(variableList["var_"+d]);break;case"format":hout+=HTMLEscape(parseFmt1(d));break;default:hout+=HTMLEscape(d)}++lineNum;break;case"writeln":switch(c[1]){case"format":hout+=HTMLEscape(parseFmt1(d))+"\n";break;default:hout+=HTMLEscape(d)+"\n"}++lineNum;break;case"clear":hout="",++lineNum;break;case"goto":switch(c[1]){case"abs":lineNum=+d;break;case"rel":lineNum+=+d;break;default:lineNum=variableList["tag_"+d]}break;case"loop":var e=d.match(/(\S*)\s*([\s\S]*)/),f=variableList["tag_"+e[2]];switch(c[1]){case"inc":variableList["var_"+e[1]]++;break;case"dec":default:variableList["var_"+e[1]]--}variableList["var_"+e[1]]?lineNum=f:++lineNum,variableList["var_"+e[1]]=""+variableList["var_"+e[1]];break;case"call":switch(c[1]){case"abs":calls[callsp++]=++lineNum,lineNum=+d;break;case"rel":calls[callsp++]=++lineNum,lineNum+=+d;break;case"ret":lineNum=calls[--callsp];break;default:calls[callsp++]=++lineNum,lineNum=variableList["tag_"+d]}break;case"break":++lineNum,breakpoint=!0,rframe=!1;break;case"nextf":++lineNum,breakpoint=!0,rframe=!0;break;case"execf":KernelStep(parseFmt1(d));break;case"set":var e=d.match(/([^=]*)\s*=([\s\S]*)/);switch(c[1]){case"f":variableList["var_"+e[1]]=parseFmt1(e[2]);break;case"a":variableList["var_"+e[1]]=""+execNumExpr(e[2]);break;case"af":variableList["var_"+e[1]]=""+execNumExpr(parseFmt1(e[2]));break;case"p":variableList["var_"+e[1]]=""+prompt(e[2]);break;case"pf":variableList["var_"+e[1]]=""+prompt(parseFmt1(e[2]));break;default:variableList["var_"+e[1]]=e[2]}++lineNum;break;case"terminate":breakpoint=!0,rframe=!1;break;case"if":var e=d.match(/(\S*)\s*(\S*)\s*(\S*)\s*([\s\S]*)/),g=cmpF(e[2],+parseFmt1(e[1]),+parseFmt1(e[3]));"not"===c[1]&&(g=!g),g?KernelStep(e[4]):++lineNum;break;case"if_str":var e=d.match(/(\S*)\s*(\S*)\s*(\S*)\s*([\s\S]*)/),g=cmpF(e[2],parseFmt1(e[1]),parseFmt1(e[3]));"not"===c[1]&&(g=!g),g?KernelStep(e[4]):++lineNum}}var firstTime=new Date,zpadd2=function(a){return 10>a?"0"+a:a},zpadd3=function(a){return 10>a?"00"+a:100>a?"0"+a:a};