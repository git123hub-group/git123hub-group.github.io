!function(){function a(){for(var a,r=0;66>r;r++)for(var e=0;82>e;e++)n(e,r,R[a=(82*r+e)*C],R[a+4])}function r(a){var r=a*T,e=0|L[r+2],t=0|L[r+3];w.fillStyle="#FFFFFF",w.fillRect(10*e,10*t,10,10)}function e(){w.clearRect(0,0,820,660);for(var a=0,e=0;x>e;a++)0!==L[a*T]&&(e++,r(a))}function t(a,r,e){var t=(82*r+a)*C;return 0!==R[t]?!1:(R[t]=e,R[t+1]=0,R[t+2]=0,R[t+3]=0,R[t+4]=0,R[t+5]=0,!0)}function n(a,r,e,t){g.globalAlpha=1,g.clearRect(10*a,10*r,10,10),0!==e&&(g.fillStyle=W[e],g.fillRect(10*a,10*r,10,10),6!==e&&4278190080&t&&(g.globalAlpha=(t>>>24)/255,g.fillStyle="#"+(t>>>0).toString(16).slice(-6),g.fillRect(10*a,10*r,10,10)))}function o(a,e,o,p){var c,m=(82*e+a)*C;if(0>=p){if(0!==o){if(!t(a,e,o))return void(8!==R[m]&&11!==R[m]&&(R[m+1]=o))}else R[m]=0;n(a,e,o,0)}else if(6>=p)0!==R[m]&&(R[m+p-1]=o,(1===p||5===p)&&n(a,e,o,R[m+4]));else if(7===p)if(0===o)S[82*e+a]=0,y.clearRect(10*a,10*e,10,10);else if(256>o)S[82*e+a]=o,y.fillStyle=z[o-1],y.fillRect(10*a,10*e,10,10);else if(!mouseEntered)switch(o){case 256:1===S[82*e+a]?_(a,e,1,2):2===S[82*e+a]&&_(a,e,2,1);break;case 257:c=s(a,e,4*Math.random(),1),D[m=82*e+a]=c,r(c)}}function _(a,r,e,t){console.debug(t);var n,o,_,p,c=[a,r],m=2;do{for(_=82*(r=c[--m]),n=o=a=c[--m];n>=0&&S[_+n-1]===e;)n--;for(;82>o&&S[_+o+1]===e;)o++;for(y.fillStyle=z[t-1],y.fillRect(10*n,10*r,10*(o-n+1),10),a=n;o>=a;a++)S[_+a]=t;if(r>=1)for(p=r-1,_-=82,a=n;o>=a;a++)S[_+a]===e&&(c[m++]=a,c[m++]=p);if(81>r)for(p=r+1,_+=164,a=n;o>=a;a++)S[_+a]===e&&(c[m++]=a,c[m++]=p)}while(m)}function p(a,r){return a>=0&&82>a&&r>=0&&66>r}function c(a,r){if(1!==S[82*r+a]){var e=R[(82*r+a)*C];null!=j[e]&&j[e](a,r);var t,n,o,_,c=K[e],m=Math.random()<.5?1:-1,i=r+1,s=!1,f=!1;switch(c){case 1:for(t=0;1>=t;t=-2*t+1){if(n=p(o=a+t*m,i),_=R[(82*i+o)*C],!n||5===_){s=!0;break}if(H[_]<H[e]){f=!0,_=e,s=!0;break}}break;case 2:for(t=0;1>=t;t=-2*t+1){if(n=p(o=a+t*m,i),_=R[(82*i+o)*C],!n||5===_){s=!0;break}if(H[_]<H[e]){f=!0,_=e,s=!0;break}1===t&&(i=r)}break;case 3:if(n=p(o=a+Math.round(2*Math.random()-1),i=r+Math.round(2*Math.random()-1)),_=R[(82*i+o)*C],!n||5===_){s=!0;break}if(0===_){f=!0,_=e,s=!0;break}break;case 4:if(n=p(o=a+Math.round(2*Math.random()-1),i=r-1),_=R[(82*i+o)*C],!n||5===_){s=!0;break}if(H[_]<H[e]){f=!0,_=e,s=!0;break}}if(s)if(f)for(var l=0;C>l;l++)t=R[m=(82*i+o)*C+l],R[m]=R[e=(82*r+a)*C+l],R[e]=t;else R[(82*r+a)*C]=0}}function m(a){var r=a*T,e=3&L[r+1],t=0|L[r+2],n=0|L[r+3],o=t,_=n,c=J[e],m=Z[e];return t+=c,n+=m,p(t,n)?(0===R[(82*n+t)*C]&&(t+=c,n+=m),p(t,n)?(f(a,o,_),D[tmp=82*n+t]=a,L[r+2]=t,void(L[r+3]=n)):(i(a),void f(a,o,_))):(i(a),void f(a,o,_))}function i(a){L[a*T]=0,L[a*T+1]=O,O=a,x--}function s(a,r,e,t){var n,o=O;return O=L[(n=o*T)+1],L[n++]=t,L[n++]=e,L[n++]=a,L[n]=r,x++,o}function f(a,r,e){var t;D[t=82*e+r]===a&&(D[t]=-1)}function l(){for(var a,r,e=0;5412>e;e++)D[e]=-1;for(var e=0,t=0;x>t;e++)if(0!==L[e*T]){t++;var n=e*T;a=0|L[n+2],r=0|L[n+3],D[82*r+a]=e}}function u(){for(var r=0,t=0;x>t;r++)0!==L[r*T]&&(t++,m(r));for(var r=0;4500>r;r++)c(82*Math.random()|0,66*Math.random()|0);x>0&&l(),e(),a()}function P(a){for(var r=ra[a++],e=ra[a],t=0;15>t;t++)e>r?(aa[t]=r,document.getElementById("Menu_"+t).value=$[r++]):(aa[t]=-1,document.getElementById("Menu_"+t).value="")}function d(a){switch(aa[a]){case 0:I=!I;break;case 1:I=!1,u();break;case 2:F(0);break;case 3:F(1);break;case 4:F(2);break;case 5:F(3);break;case 6:F(4);break;case 7:E=7,A=oa[1],na=1;for(var r=4;15>r;r++)_a[r]=-1,document.getElementById("Part_"+r).value="";for(var r=0;4>r;r++)_a[r]=ta[r],document.getElementById("Part_"+r).value=ea[r];break;case 8:P(1);break;case 9:P(0);break;case 10:v(1);break;case 11:v(2);break;case 12:v(3);break;case 13:v(4);break;case 14:v(5);break;case 15:v(6)}}function v(a){var r=prompt("Change particle property");null!=r&&(E=a,A="#"===r.charAt(0)||"0x"===r.substr(0,2)?parseInt(r.slice(-8),16):parseInt(r))}function h(a){a>=0&&(oa[na]=A=_a[a])}function F(a){7!==E&&(E=0,na=0,A=oa[0]);for(var r,e=0,t=0;15>t;t++)_a[t]=-1,document.getElementById("Part_"+t).value="";for(var t=0;Q>t;t++)q[t]===a&&(_a[e]=t,e++);for(var t=0;15>t&&e>t;t++)r=_a[t],document.getElementById("Part_"+t).value=Y[r]}for(var I,k=document.getElementById("InvisLayer"),M=document.getElementById("PartLayer"),b=document.getElementById("PhotonsLayer"),y=k.getContext("2d"),g=M.getContext("2d"),w=b.getContext("2d"),A=2,E=0,C=6,T=4,B=0,S=new Uint8Array(5412),R=new Int32Array(5412*C),D=new Int16Array(5412),L=new Int16Array(6e3*T),x=0,O=0,X=0;82>X;X++)R[X*C]=1,R[(X+5330)*C]=1;for(var X=0;66>X;X++)R[82*X*C]=1,R[(82*X+81)*C]=1;for(var X=0;5999>X;)L[4*X+1]=++X;L[23997]=-1;for(var X=0;5412>X;X++)D[X]=-1;var Y=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE"],W=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000"],U=[0,0,1,1,0,0,1,1,1,1,1,1],N=[0,0,1,1,1,1,0,0,1,1,1,1],G=[0,0,1,0,0,0,1,1,0,.2,1,0],V=[0,0,1,0,0,0,0,0,0,1,0,0],K=[0,0,1,2,0,0,2,2,2,2,2,4],q=[4,4,1,2,4,4,2,2,2,2,2,3],H=[0,1e3,800,400,1e3,0,420,420,390,300,900,1],Q=13,j=[null,null,null,null,function(a,r){var e,n=(82*r+a)*C+1;if(0!==(e=R[n])){var o=a+(3*Math.random()|0)-1,_=r+(3*Math.random()|0)-1;p(o,_)&&t(o,_,e)}else a:for(var c=-1;2>c;c++)for(var m=-1;2>m;m++)if(p(o=a+c,_=r+m)&&(e=R[(82*_+o)*C],U[e])){R[n]=e;break a}},null,function(a,r){var e,t,n,o,_=(82*r+a)*C;if(R[_+5]>0){for(var c=0;4>c;c++)e=a+(3*Math.random()|0)-1,t=r+(3*Math.random()|0)-1,p(e,t)&&(n=(82*t+e)*C,6===R[n]&&R[n+5]<=0&&(R[n+5]=R[_+5]+2));return void(--R[_+5]||(R[_]=R[_+3],R[_+3]=0))}e=a+(3*Math.random()|0)-1,t=r+(3*Math.random()|0)-1,p(e,t)&&(n=(82*t+e)*C,o=R[n],7===o?(R[n]=0,R[_+5]=30):N[o]&&(R[n]=6,R[n+3]=o,R[n+5]=0),console.log(R[_+5]))},null,function(a,r){var e,t,n=30,o=(82*r+a)*C+1;if(.6<Math.random()){if(newX=a+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!p(newX,newY))return;if(e=(82*newY+newX)*C,t=R[e],3===t)return t=R[o]+n>>1,R[e]=8,void(R[e+1]=R[o]=t);if(8===t)return void(R[o]>=n?R[o-1]=0:(t=R[e+1]-R[o]>>1,R[e+1]-=t,R[o]+=t));Math.random()<G[t]&&(R[e]=0,R[o]+=2)}},null,null,function(a,r){var e=(82*r+a)*C+1;R[e]>18&&(R[e-1]=0);for(var t=0;2>t;t++)if(newX=a+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,p(newX,newY)){var n=(82*newY+newX)*C;V[R[n]]&&(R[n]=11,R[n+1]=0)}R[e]++}],z=["#00CCCC","#0F0064"],J=[1,0,-1,0],Z=[0,-1,0,1],$=["PAUS","FRAM","SOLD","PWDR","LIQD","GAS","SPEC","INVS","PROP","BACK","TYPE","CTYP","ARG3","ARG4","DECO","TMP"],aa=[],ra=[0,9,16];P(0);var ea=["X","INVS","TOGL","PHOT"],ta=[0,1,256,257],na=0,oa=[2,1];a();var _a=[];F(1),!function pa(){I&&B>5&&(u(),B=0),B++,requestAnimationFrame(pa)}(),window.selectOpt=d,window.selectPart=h,window.mouse_partOP=o}();