var currentType=2,currentProp=0;!function(){function r(){for(var r,a=0;66>a;a++)for(var e=0;82>e;e++)t(e,a,S[r=(82*a+e)*C],S[r+4])}function a(r){var a=r*E,e=0|T[a+2],n=0|T[a+3];A.fillStyle="#FFFFFF",A.fillRect(10*e,10*n,10,10)}function e(){A.clearRect(0,0,820,660);for(var r=0,e=0;D>e;r++)0!==T[r*E]&&(e++,a(r))}function n(r,a,e){var n=(82*a+r)*C;return 0!==S[n]?!1:(S[n]=e,S[n+1]=0,S[n+2]=0,S[n+3]=0,S[n+4]=0,S[n+5]=0,!0)}function t(r,a,e,n){y.globalAlpha=1,y.clearRect(10*r,10*a,10,10),0!==e&&(y.fillStyle=Y[e],y.fillRect(10*r,10*a,10,10),6!==e&&4278190080&n&&(y.globalAlpha=(n>>>24)/255,y.fillStyle="#"+(n>>>0).toString(16).slice(-6),y.fillRect(10*r,10*a,10,10)))}function o(r,e,o,i){var l,c=(82*e+r)*C;if(0>=i){if(0!==o){if(!n(r,e,o))return void(8!==S[c]&&11!==S[c]&&(S[c+1]=o))}else S[c]=0;t(r,e,o,0)}else if(6>=i)0!==S[c]&&(S[c+i-1]=o,(1===i||5===i)&&t(r,e,o,S[c+4]));else if(7===i)if(0===o)R[82*e+r]=0,w.clearRect(10*r,10*e,10,10);else if(256>o)R[82*e+r]=o,w.fillStyle=Q[o-1],w.fillRect(10*r,10*e,10,10);else if(!mouseEntered)switch(o){case 256:1===R[82*e+r]?f(r,e,1,2):2===R[82*e+r]&&f(r,e,2,1);break;case 257:l=v(r,e,4*Math.random(),1),B[c=82*e+r]=l,a(l)}}function f(r,a,e,n){console.debug(n);var t,o,f,i,l=[r,a],c=2;do{for(f=82*(a=l[--c]),t=o=r=l[--c];t>=0&&R[f+t-1]===e;)t--;for(;82>o&&R[f+o+1]===e;)o++;for(w.fillStyle=Q[n-1],w.fillRect(10*t,10*a,10*(o-t+1),10),r=t;o>=r;r++)R[f+r]=n;if(a>=1)for(i=a-1,f-=82,r=t;o>=r;r++)R[f+r]===e&&(l[c++]=r,l[c++]=i);if(81>a)for(i=a+1,f+=164,r=t;o>=r;r++)R[f+r]===e&&(l[c++]=r,l[c++]=i)}while(c)}function i(r,a){return r>=0&&82>r&&a>=0&&66>a}function l(r,a){if(1!==R[82*a+r]){var e=S[(82*a+r)*C];null!=H[e]&&H[e](r,a);var n,t,o,f,l=N[e],c=Math.random()<.5?1:-1,u=a+1,v=!1,s=!1;switch(l){case 1:for(n=0;1>=n;n=-2*n+1){if(t=i(o=r+n*c,u),f=S[(82*u+o)*C],!t||5===f){v=!0;break}if(K[f]<K[e]){s=!0,f=e,v=!0;break}}break;case 2:for(n=0;1>=n;n=-2*n+1){if(t=i(o=r+n*c,u),f=S[(82*u+o)*C],!t||5===f){v=!0;break}if(K[f]<K[e]){s=!0,f=e,v=!0;break}1===n&&(u=a)}break;case 3:if(t=i(o=r+Math.round(2*Math.random()-1),u=a+Math.round(2*Math.random()-1)),f=S[(82*u+o)*C],!t||5===f){v=!0;break}if(0===f){s=!0,f=e,v=!0;break}break;case 4:if(t=i(o=r+Math.round(2*Math.random()-1),u=a-1),f=S[(82*u+o)*C],!t||5===f){v=!0;break}if(K[f]<K[e]){s=!0,f=e,v=!0;break}}if(v)if(s)for(var m=0;C>m;m++)n=S[c=(82*u+o)*C+m],S[c]=S[e=(82*a+r)*C+m],S[e]=n;else S[(82*a+r)*C]=0}}function c(r){var a=r*E,e=3&T[a+1],n=0|T[a+2],t=0|T[a+3],o=n,f=t,l=j[e],c=z[e];return n+=l,t+=c,i(n,t)?(0===S[(82*t+n)*C]&&(n+=l,t+=c),i(n,t)?(s(r,o,f),B[tmp=82*t+n]=r,T[a+2]=n,void(T[a+3]=t)):(u(r),void s(r,o,f))):(u(r),void s(r,o,f))}function u(r){T[r*E]=0,T[r*E+1]=L,L=r,D--}function v(r,a,e,n){var t,o=L;return L=T[(t=o*E)+1],T[t++]=n,T[t++]=e,T[t++]=r,T[t]=a,D++,o}function s(r,a,e){var n;B[n=82*e+a]===r&&(B[n]=-1)}function m(){for(var r,a,e=0;5412>e;e++)B[e]=-1;for(var e=0,n=0;D>n;e++)if(0!==T[e*E]){n++;var t=e*E;r=0|T[t+2],a=0|T[t+3],B[82*a+r]=e}}function d(){for(var a=0,n=0;D>n;a++)0!==T[a*E]&&(n++,c(a));for(var a=0;4500>a;a++)l(82*Math.random()|0,66*Math.random()|0);D>0&&m(),e(),r()}function p(r){for(var a=$[r++],e=$[r],n=0;15>n;n++)e>a?(Z[n]=a,document.getElementById("Menu_"+n).value=J[a++]):(Z[n]=-1,document.getElementById("Menu_"+n).value="")}function _(r){switch(Z[r]){case 0:k=!k;break;case 1:k=!1,d();break;case 2:b(0);break;case 3:b(1);break;case 4:b(2);break;case 5:b(3);break;case 6:b(4);break;case 7:currentProp=7,currentType=nr[1],er=1;for(var a=4;15>a;a++)tr[a]=-1,document.getElementById("Part_"+a).value="";for(var a=0;4>a;a++)tr[a]=ar[a],document.getElementById("Part_"+a).value=rr[a];break;case 8:p(1);break;case 9:p(0);break;case 10:h(1);break;case 11:h(2);break;case 12:h(3);break;case 13:h(4);break;case 14:h(5);break;case 15:h(6)}}function h(r){var a=prompt("Change particle property");null!=a&&(currentProp=r,currentType="#"===a.charAt(0)||"0x"===a.substr(0,2)?parseInt(a.slice(-8),16):parseInt(a))}function P(r){r>=0&&(nr[er]=currentType=tr[r])}function b(r){7!==currentProp&&(currentProp=0,er=0,currentType=nr[0]);for(var a,e=0,n=0;15>n;n++)tr[n]=-1,document.getElementById("Part_"+n).value="";for(var n=0;q>n;n++)W[n]===r&&(tr[e]=n,e++);for(var n=0;15>n&&e>n;n++)a=tr[n],document.getElementById("Part_"+n).value=X[a]}for(var k,M=document.getElementById("InvisLayer"),F=document.getElementById("PartLayer"),I=document.getElementById("PhotonsLayer"),w=M.getContext("2d"),y=F.getContext("2d"),A=I.getContext("2d"),C=6,E=4,g=0,R=new Uint8Array(5412),S=new Int32Array(5412*C),B=new Int16Array(5412),T=new Int16Array(6e3*E),D=0,L=0,O=0;82>O;O++)S[O*C]=1,S[(O+5330)*C]=1;for(var O=0;66>O;O++)S[82*O*C]=1,S[(82*O+81)*C]=1;for(var O=0;5999>O;)T[4*O+1]=++O;T[23997]=-1;for(var O=0;5412>O;O++)B[O]=-1;var X=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE"],Y=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000"],x=[0,0,1,1,0,0,1,1,1,1,1,1],U=[0,0,1,1,1,1,0,0,1,1,1,1],G=[0,0,1,0,0,0,1,1,0,.2,1,0],V=[0,0,1,0,0,0,0,0,0,1,0,0],N=[0,0,1,2,0,0,2,2,2,2,2,4],W=[4,4,1,2,4,4,2,2,2,2,2,3],K=[0,1e3,800,400,1e3,0,420,420,390,300,900,1],q=13,H=[null,null,null,null,function(r,a){var e,t=(82*a+r)*C+1;if(0!==(e=S[t])){var o=r+(3*Math.random()|0)-1,f=a+(3*Math.random()|0)-1;i(o,f)&&n(o,f,e)}else r:for(var l=-1;2>l;l++)for(var c=-1;2>c;c++)if(i(o=r+l,f=a+c)&&(e=S[(82*f+o)*C],x[e])){S[t]=e;break r}},null,function(r,a){var e,n,t,o,f=(82*a+r)*C;if(S[f+5]>0){for(var l=0;4>l;l++)e=r+(3*Math.random()|0)-1,n=a+(3*Math.random()|0)-1,i(e,n)&&(t=(82*n+e)*C,6===S[t]&&S[t+5]<=0&&(S[t+5]=S[f+5]+2));return void(--S[f+5]||(S[f]=S[f+3],S[f+3]=0))}e=r+(3*Math.random()|0)-1,n=a+(3*Math.random()|0)-1,i(e,n)&&(t=(82*n+e)*C,o=S[t],7===o?(S[t]=0,S[f+5]=30):U[o]&&(S[t]=6,S[t+3]=o,S[t+5]=0),console.log(S[f+5]))},null,function(r,a){var e,n,t=30,o=(82*a+r)*C+1;if(.6<Math.random()){if(newX=r+(3*Math.random()|0)-1,newY=a+(3*Math.random()|0)-1,!i(newX,newY))return;if(e=(82*newY+newX)*C,n=S[e],3===n)return n=S[o]+t>>1,S[e]=8,void(S[e+1]=S[o]=n);if(8===n)return void(S[o]>=t?S[o-1]=0:(n=S[e+1]-S[o]>>1,S[e+1]-=n,S[o]+=n));Math.random()<G[n]&&(S[e]=0,S[o]+=2)}},null,null,function(r,a){var e=(82*a+r)*C+1;S[e]>18&&(S[e-1]=0);for(var n=0;2>n;n++)if(newX=r+(3*Math.random()|0)-1,newY=a+(3*Math.random()|0)-1,i(newX,newY)){var t=(82*newY+newX)*C;V[S[t]]&&(S[t]=11,S[t+1]=0)}S[e]++}],Q=["#00CCCC","#0F0064"],j=[1,0,-1,0],z=[0,-1,0,1],J=["PAUS","FRAM","SOLD","PWDR","LIQD","GAS","SPEC","INVS","PROP","BACK","TYPE","CTYP","ARG3","ARG4","DECO","TMP"],Z=[],$=[0,9,16];p(0);var rr=["X","INVS","TOGL","PHOT"],ar=[0,1,256,257],er=0,nr=[2,1];r();var tr=[];b(1),!function or(){k&&g>5&&(d(),g=0),g++,requestAnimationFrame(or)}(),window.selectOpt=_,window.selectPart=P,window.mouse_partOP=o}();