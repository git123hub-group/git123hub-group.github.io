var currentType=2,currentProp=0;!function(){function e(){for(var e,r=0;66>r;r++)for(var a=0;82>a;a++)t(a,r,g[e=(82*r+a)*I],g[e+N],e)}function r(e){var r=e*P,a=0|L[r+1],n=0|L[r+2];E.fillStyle="#FFFFFF",E.fillRect(10*a,10*n,10,10)}function a(){E.clearRect(0,0,820,660);for(var e=0,a=0;O>a;e++)0!==L[e*P]&&(a++,r(e))}function n(e,r,a){var n=(82*r+e)*I;if(0!==g[n])return!1;for(g[n]=a,iter=1;iter<I;iter++)g[n+iter]=0;return!0}function t(e,r,a,n,t){var o,c,i,f,s=!1;if(S.globalAlpha=1,S.clearRect(10*e,10*r,10,10),0!==a){switch(a){case 6:s=!0,o=g[t+W],c=254-o,i=17,f=246-o,S.fillStyle="#"+(256*(256*(256+c)+i)+f).toString(16).slice(-6);break;case 20:s=!0,S.fillStyle=j[a];break;case 26:o=g[t+1],c=192-o,i=176-o,f=80-(o>>1),S.fillStyle="#"+(256*(256*(256+c)+i)+f).toString(16).slice(-6);break;case 19:switch(o=g[t+2],c=255-20*o,50>c&&(c=50),i=190-20*o,50>i&&(i=50),f=48-20*o,20>f&&(f=20),g[t+1]){case 1:o=c,c=i,i=o;break;case 2:o=f,f=i,i=c,c=o;break;case 3:o=f,f=i,i=o}S.fillStyle="#"+(256*(256*(256+c)+i)+f).toString(16).slice(-6);break;default:S.fillStyle=j[a]}S.fillRect(10*e,10*r,10,10),!s&&4278190080&n&&(S.globalAlpha=(n>>>24)/255,S.fillStyle="#"+(n>>>0).toString(16).slice(-6),S.fillRect(10*e,10*r,10,10))}}function o(e,a,o,i){var f,s,u,l=(82*a+e)*I;if(0>=i){if(0!==o){if(!n(e,a,o))return void(g[l]!=o&&(4===g[l]||25===g[l])&&(g[l+1]=o));10==g[l]?g[l+1]=1:(15==g[l]||16==g[l])&&(g[l+1]=ae)}else g[l]=0;t(e,a,o,0,l)}else if(I>=i)0!==g[l]&&(g[l+i-1]=o,t(e,a,g[l],g[l+N],l));else if(i===I+1)if(256>o){var d=R[82*a+e];if(mouseEntered&&6===o)return;6===d&&(u=B[82*a+e],_--,D[4*u]=D[4*_],D[4*u+1]=D[4*_+1],D[4*u+2]=D[4*_+2],D[4*u+3]=D[4*_+3]),6===o&&(B[82*a+e]=_,D[4*_]=e,D[4*_+1]=a,s=4*Math.random()|0,D[4*_+2]=ce[s],D[4*_+3]=ie[s],_++),0===o?(R[82*a+e]=0,Y.clearRect(10*e,10*a,10,10)):(R[82*a+e]=o,Y.fillStyle=fe[o-1],Y.fillRect(10*e,10*a,10,10))}else if(!mouseEntered)switch(o){case 256:1===R[82*a+e]?c(e,a,1,2):2===R[82*a+e]&&c(e,a,2,1);break;case 257:s=4*Math.random()|0,f=v(e,a,ce[s],ie[s],1),T[l=82*a+e]=f,r(f)}}function c(e,r,a,n){console.debug(n);var t,o,c,i,f=[e,r],s=2;do{for(c=82*(r=f[--s]),t=o=e=f[--s];t>=0&&R[c+t-1]===a;)t--;for(;82>o&&R[c+o+1]===a;)o++;for(Y.fillStyle=fe[n-1],Y.fillRect(10*t,10*r,10*(o-t+1),10),e=t;o>=e;e++)R[c+e]=n;if(r>=1)for(i=r-1,c-=82,e=t;o>=e;e++)R[c+e]===a&&(f[s++]=e,f[s++]=i);if(81>r)for(i=r+1,c+=164,e=t;o>=e;e++)R[c+e]===a&&(f[s++]=e,f[s++]=i)}while(s)}function i(e,r){return e>=0&&82>e&&r>=0&&66>r}function f(e,r,a,n){switch(R[82*r+e]){case 1:case 6:return!1;case 3:if(2!==J[a]&&0!==n)return!1;break;case 4:if(1!==J[a]&&0!==n)return!1;break;case 7:if(5!==J[a]&&0!==n)return!1;break;case 5:if(3!==J[a]&&4!==J[a]&&0!==n)return!1}return!0}function s(e,r){var a,n=g[(82*r+e)*I];if(f(e,r,n,0)){null!=oe[n]&&oe[n](e,r);var t,o,c,s,u,l,v=J[n],d=Math.random()<.5?1:-1,w=r+1,h=!1,b=!1;switch(v){case 1:case 5:for(5===v&&(w=r-1),t=0;1>=t;t=-2*t+1){if(o=i(c=e+t*d,w),s=g[(82*w+c)*I],!o||5===s){h=!0;break}if(f(c,w,n,1)&&29!==s&&$[s]<$[n]){b=!0,s=n,h=!0;break}}break;case 2:for(t=0;1>=t;t=-2*t+1){if(o=i(c=e+t*d,w),s=g[(82*w+c)*I],!o||5===s){h=!0;break}if(f(c,w,n,1)){if($[s]<$[n]){b=!0,s=n,h=!0;break}1===t&&(w=r)}}break;case 3:if(o=i(c=e+Math.round(2.2*Math.random()-1.1),w=r+Math.round(2.2*Math.random()-1.1)),s=g[(82*w+c)*I],!o||5===s){h=!0;break}if(!f(c,w,n,1))return;if(0===s){b=!0,s=n,h=!0;break}break;case 4:for(t=1;t>=0;){if(o=i(c=e+(d=Math.round(2*Math.random()-1)),w=r-t--),s=g[(82*w+c)*I],!o||5===s){h=!0;break}if(!f(c,w,n,1))return;if($[s]<$[n]){b=!0,s=n,h=!0;break}}break;case 6:for(t=3,c=e,w=r,h=!0,b=!0;t--;){if(u=c+(3*Math.random()|0)-1,l=w+(3*Math.random()|0)-1,s=g[(82*l+u)*I],!i(u,l)||5===s){b=!1;break}1!==s&&4!==s&&(c=u,w=l)}}if(h)if(b){a=(82*w+c)*I;var m=g[a];if(m&&!f(e,r,m,2))return;for(var k=0;I>k;k++)t=g[d=a+k],g[d]=g[n=(82*r+e)*I+k],g[n]=t}else g[(82*r+e)*I]=0}}function u(e){var r=e*P,a=0|L[r+1],n=0|L[r+2],t=a,o=n,c=0|L[r+3],f=0|L[r+4];return 1&L[r+5]?(L[r+5]&=-2,1):(a+=c,n+=f,i(a,n)?(0===g[(82*n+a)*I]&&(a+=c,n+=f),i(a,n)&&5!==g[(82*n+a)*I]?(d(e,t,o),T[tmp=82*n+a]=e,L[r+1]=a,L[r+2]=n,1):(l(e),d(e,t,o),0)):(l(e),d(e,t,o),0))}function l(e){L[e*P]=0,L[e*P+5]=x,x=e,O--}function v(e,r,a,n,t){var o,c=x;return x=L[(o=c*P)+5],L[o++]=t,L[o++]=e,L[o++]=r,L[o++]=a,L[o++]=n,L[o++]=0,O++,c}function d(e,r,a){var n;T[n=82*a+r]===e&&(T[n]=-1)}function w(){for(var e,r,a=0;5412>a;a++)T[a]=-1;for(var a=0,n=0;O>n;a++)if(0!==L[a*P]){n++;var t=a*P;e=0|L[t+1],r=0|L[t+2],T[82*r+e]=a}}function h(){for(var r,n,t,o,c,i=0,f=0;_>f;f++)r=D[i++],n=D[i++],t=D[i++],o=D[i++],c=v(r,n,t,o,1),T[tmp=82*n+r]=c;for(var f=0,l=0;O>l;f++)0!==L[f*P]&&(l+=u(f));for(var f=0;4500>f;f++)s(82*Math.random()|0,66*Math.random()|0);O>0&&w(),a(),e()}function b(e){for(var r=le[e++],a=le[e],n=0;15>n;n++)a>r?(ue[n]=r,document.getElementById("Menu_"+n).value=se[r++]):(ue[n]=-1,document.getElementById("Menu_"+n).value="")}function m(e){switch(ue[e]){case 0:y=!y;break;case 1:y=!1,h();break;case 2:F(0);break;case 3:F(1);break;case 4:F(2);break;case 5:F(3);break;case 6:F(4);break;case 7:currentProp=I+1,currentType=he[1],we=1;for(var r=4;15>r;r++)be[r]=-1,document.getElementById("Part_"+r).value="";for(var r=0;9>r;r++)be[r]=de[r],document.getElementById("Part_"+r).value=ve[r];break;case 8:b(1);break;case 9:for(var a=["TPT","CNWL","ETRC","RETN"],r=0;15>r;r++)currentProp=-1,be[r]=r,document.getElementById("Part_"+r).value=4>r?a[r]:"";break;case 10:b(0);break;case 11:k(1);break;case 12:k(2);break;case 13:k(3);break;case 14:k(4);break;case 15:k(5);break;case 16:k(6);break;case 17:k(7);break;case 18:k(8);break;case 19:k(9);break;case 20:k(10)}}function k(e){var r=prompt("Change particle property");null!=r&&(currentProp=e,currentType="#"===r.charAt(0)||"0x"===r.substr(0,2)?parseInt(r.slice(-8),16):parseInt(r))}function M(e){if(currentProp>=0)e>=0&&(he[we]=currentType=be[e]);else if(3>e){var r=["http://powdertoy.co.uk/","http://conwaylife.com/","SimplePowder/electronics","https://git123hub.github.io/index/"];location.href=r[e]}}function F(e){0!==currentProp&&(currentProp=0,we=0,currentType=he[0]);for(var r,a=0,n=0;15>n;n++)be[n]=-1,document.getElementById("Part_"+n).value="";for(var n=0;ee>n;n++)Z[n]===e&&(be[a]=n,a++);for(var n=0;15>n&&a>n;n++)r=be[n],document.getElementById("Part_"+n).value=U[r]}for(var y,A=document.getElementById("InvisLayer"),p=document.getElementById("PartLayer"),C=document.getElementById("PhotonsLayer"),Y=A.getContext("2d"),S=p.getContext("2d"),E=C.getContext("2d"),I=10,P=6,X=0,R=new Uint8Array(5412),g=new Int32Array(5412*I),T=new Int16Array(5412),L=new Int16Array(6e3*P),B=new Int16Array(5412),D=new Int8Array(2e3),_=0,O=0,x=0,N=I-3,G=I-1,W=I-2,V=I-4,K=0;82>K;K++)g[K*I]=1,g[(K+5330)*I]=1;for(var K=0;66>K;K++)g[82*K*I]=1,g[(82*K+81)*I]=1;for(var K=0;5999>K;)L[K*P+5]=++K;L[5999*P+5]=-1;for(var K=0;5412>K;K++)T[K]=-1;var U=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE","WOOD","WTRV","BASE","SLTW","SALT","BRCK","PLNT","WPIP","VRSS","ANAR","IGRV","CFLM","FIRE","CONV","IGNT","ICE","WARP","SAWD","ROTL","ROTR"],j=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000","#BF9C1D","#A0A0FF","#13BDFF","#505CD4","#FFFFFF","#999999","#0CAC00","#FFBE30","#BE11B6","#FFFFEE","#66FF33","#8080E0","#FF0000","#0AAB0A","#C0B050","#A0C0FF","#000000","#F0F0A0","#664433","#664433"],q=[0,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,1,0,0,0,0,1,0,1,0,0,0,0,1,1,0,0],H=[0,0,1,1,0,0,0,0,1,1,1,0,1,2,1,1,1,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1],Q=[0,0,1,0,0,0,1,1,0,.2,1,0,1,1,0,0,0,0,1,1,.5,1,0,0,0,0,0,0,0,1,0,0],z=[0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0],J=[0,0,1,2,0,0,2,2,2,2,2,4,0,4,2,2,1,0,0,0,0,5,0,4,0,0,0,0,6,1,0,0],Z=[4,4,1,2,4,4,2,2,2,2,2,3,0,3,2,2,1,0,0,4,-1,1,4,3,-1,4,0,0,3,1,4,4],$=[0,1e3,800,400,1e3,0,420,420,390,300,900,1,1e3,1,390,440,890,1e3,1e3,1e3,1e3,800,1e3,1,1,1e3,1e3,1e3,1,250,1e3,1e3],ee=32,re=30,ae=50,ne=ae,te=[[0,1,2,1],[2,0,1,1],[1,2,0,1],[2,2,2,0]],oe=[null,null,null,null,function(e,r){var a,t=(82*r+e)*I+1;if(0!==(a=g[t])){var o=e+(3*Math.random()|0)-1,c=r+(3*Math.random()|0)-1;i(o,c)&&n(o,c,a)}else e:for(var f=-1;2>f;f++)for(var s=-1;2>s;s++)if(i(o=e+f,c=r+s)&&(a=g[(82*c+o)*I],q[a])){g[t]=a;break e}},null,function(e,r){var a,n,t,o,c,f=(82*r+e)*I;if(g[f+G]>0){for(var s=0;4>s;s++)a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,i(a,n)&&(t=(82*n+a)*I,o=g[t],(6===o||20===o)&&g[t+G]<=0&&(g[t+G]=g[f+G]+2));return void(--g[f+G]||(g[f]=g[f+V],g[f+V]=0,g[f+W]=0))}if(a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,i(a,n))switch(t=(82*n+a)*I,o=g[t],c=f+W,g[c]>0&&g[c]--,o){case 6:20===g[f]&&(g[t+W]>0?(g[f]=6,g[c]=50):g[t]=20);break;case 7:g[t]=0,g[f+G]=30;break;case 11:g[f]=6,g[c]=50;break;case 23:g[f]=20;break;default:H[o]&&(c=2===H[o],g[t]=c?6:20,g[t+V]=o,g[t+G]=0,g[t+W]=50)}},null,function(e,r){var a,n,t=(82*r+e)*I+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!i(newX,newY))return;switch(a=(82*newY+newX)*I,n=g[a]){case 3:return n=g[t]+re>>1,g[a]=8,void(g[a+1]=g[t]=n);case 8:return void(g[t]>=re?g[t-1]=0:(n=g[a+1]-g[t]>>1,g[a+1]-=n,g[t]+=n))}Math.random()<Q[n]&&(g[a]=0,g[t]+=2)}},null,function(e,r){for(var a,t,o,c=(82*r+e)*I+1,f=0;2>f;f++)newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!i(newX,newY)||newX==e&&newY==r||(o=(82*newY+newX)*I,a=g[o],!a&&g[c]>1?(g[c]--,n(newX,newY,10),g[o+1]=0):10==a&&(t=g[c]+g[o+1],2>t?(g[c]=t+1,g[o]=0):(g[c]=t>>1,g[o+1]=t+1>>1)))},function(e,r){var a,n=(82*r+e)*I+1,t=g[n-1],o=g[n];11==t?o>18&&(g[n-1]=0):4==o&&(g[n-1]=11,g[n]=0);for(var c=0;2>c;c++)if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var f=(82*newY+newX)*I,s=!0;do{switch(a=g[f]){case 3:2.5*Math.random()-1.25>newY-r?g[f]=13:g[n-1]=0,f=0;break;case 10:Math.random()<.4&&(g[f+1]+=1),f=0;break;case 15:2.5*Math.random()-1.25>newY-r?(ne+=g[f+1],ne>=2*ae?(g[f]=16,g[f+1]=ae,ne-=2*ae):(g[f]=13,g[f+1]=0)):g[n-1]=0,f=0;break;case 27:0===g[f+1]&&(g[f+1]=50);break;default:if(z[a]&&s){g[f]=24,g[f+1]=0,f=0;break}}if(f-=82*I,0>f)break;s=!s}while(!s)}g[n]++},null,function(e,r){var a,n=(82*r+e)*I;if(g[n+1]>0){if(g[n+1]--,0===g[n+1])return void(g[n]=3);newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)&&(a=(82*newY+newX)*I,(13==g[a]||27==g[a])&&g[a+1]<=0&&(g[a+1]=50))}else r>0&&17===g[n-82*I]&&(g[n+1]=50)},function(e,r){var a,n,t,o=(82*r+e)*I+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!i(newX,newY))return;switch(a=(82*newY+newX)*I,n=g[a]){case 3:return n=g[o]+re>>1,g[a]=14,void(g[a+1]=g[o]=n);case 7:return;case 8:return t=g[a+1]-g[o],t>=0?(g[a]=15,g[a+1]=ae):g[a+1]=30+t,void(0>=t?(g[o-1]=15,g[o]=ae):g[o]=30-t);case 9:return g[o]+=8,g[a]=7,void(g[o]>=re&&(g[o-1]=0));case 14:return void(g[o]>=re?g[o-1]=0:(n=g[a+1]-g[o]>>1,g[a+1]-=n,g[o]+=n))}Math.random()<Q[n]&&(g[a]=0,g[o]+=2)}},function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)&&(newX!=e||newY!=r)){var a,n,t=(82*r+e)*I+1,o=(82*newY+newX)*I;switch(g[o]){case 3:a=g[t],n=a>>1,a-=n,n>0?g[t]=n:g[t-1]=3,g[o]=15,g[o+1]=a;break;case 15:a=g[t]+g[o+1],n=a>>1,g[o+1]=a-n,g[t]=n;break;case 16:a=g[t]+g[o+1],g[t]=ae,a>ae?g[o+1]=a-ae:(g[o]=15,g[o+1]=a)}}},function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var a=(82*r+e)*I,n=(82*newY+newX)*I;3===g[n]&&(g[a]=15,g[n]=15,g[n+1]=ae)}},null,function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var a=(82*r+e)*I,n=(82*newY+newX)*I;if(Math.random()<.2)switch(g[n]){case 3:g[n]=18;break;case 15:g[a]=0}}},function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var a,t,o,c=(82*r+e)*I,f=(82*newY+newX)*I,s=g[c+1];switch(g[f]){case 0:3==s&&g[c+2]&&(n(newX,newY,3),g[c+2]--);break;case 3:3!=s&&(g[f]=0,g[c+2]++);break;case 15:3!=s&&(ne+=g[f+1],ne>=2*ae?(g[f]=16,g[f+1]=ae,ne-=2*ae):(g[f]=0,g[c+2]++));break;case 19:switch(o=te[s][g[f+1]],a=g[f+2]+g[c+2],o){case 0:t=a>>1;break;case 1:t=0;break;case 2:t=a}g[c+2]=t,g[f+2]=a-t}}},null,null,function(e,r){var a,n;r>=1&&(a=r-1,n=(82*a+e)*I,(2===g[n]||29===g[n])&&(g[n+1]=g[n],g[n]=21)),65>r&&(a=r+1,n=(82*a+e)*I,21===g[n]&&(g[n]=g[n+1],g[n]||(g[n]=2),g[n+1]=0))},function(e,r){var a,n=(82*r+e)*I+1;g[n]>18&&(g[n-1]=0);for(var t=0;2>t;t++)if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var o=(82*newY+newX)*I,c=!0;do{switch(a=g[o]){case 3:Math.random()<.3&&(g[o]=27),o=0;break;case 10:Math.random()<.6&&g[o+1]>0&&(g[o+1]-=1),o=0;break;case 13:2.5*Math.random()-1.25>newY-r&&(g[o+1]=50),o=0;break;case 21:Math.random()<.7&&(g[o]=23,g[o+1]=0),o=0}if(o-=82*I,0>o)break;c=!c}while(!c)}g[n]++},null,function(e,r){for(var a,t=(82*r+e)*I+1,o=0;4>o;o++){var c=e+(3*Math.random()|0)-1,f=r+(3*Math.random()|0)-1;i(c,f)&&(a=(82*f+c)*I,g[a]>=2&&4!==g[a]&&25!==g[a]&&(g[t]&&g[t]!=g[a]?(g[a]=0,n(c,f,g[t])):g[t]=g[a]))}},function(e,r){var a,n=(82*r+e)*I+1,t=e+(3*Math.random()|0)-1,o=r+(3*Math.random()|0)-1;0!==g[n]?g[n]<120?g[n]++:(g[n]=0,g[n-1]=24):i(t,o)&&(a=(82*o+t)*I,(8===g[a]||11===g[a]||14===g[a]||26===g[a]&&g[a+1]>80)&&(g[n]=1))},function(e,r){var a,n=(82*r+e)*I+1,t=e+(3*Math.random()|0)-1,o=r+(3*Math.random()|0)-1;i(t,o)&&(a=(82*o+t)*I,g[n]<=0?3===g[a]?Math.random()<.2&&(g[a]=27,g[a+1]=0):(13===g[a]||15===g[a]||16===g[a])&&(13===g[a]&&(g[a+1]=50),g[n]=50):(13===g[a]||27===g[a])&&g[a+1]<=0&&(g[a+1]=50)),g[n]>0&&(g[n]--,g[n]||(g[n-1]=3))},null,null,function(e,r){var a,n,t,o,c,i,f=(82*r+e)*I,s=30==g[f]?1:-1,u=Math.random()<.5?0:s;a=u-s,n=u;for(var l,v,d,w,h=0;4>h;h++)if(rx=ce[h],ry=ie[h],l=e+rx+a*ry,v=r+ry-a*rx,c=g[t=(82*v+l)*I],!(2>c||4===c||30===c||31===c||(d=e+rx+n*ry,w=r+ry-n*rx,i=g[o=(82*w+d)*I]))){for(iter=0;iter<I;iter++)g[o+iter]=g[t+iter];g[t]=0}},null];oe[20]=oe[6],oe[24]=oe[11],oe[31]=oe[30];var ce=[1,0,-1,0],ie=[0,1,0,-1],fe=["#00CCCC","#0F0064","#555577","#775555","#557755","#885088","#996655"],se=["PAUS","FRAM","SOLID","PWDR","LIQD","GAS","SPEC","INVS","PROP","LINK","BACK","TYPE","CTYP","ARG3","ARG4","ARG5","ARG6","ITYPE","DECO","TMP","TMP2"],ue=[],le=[0,10,21];b(0);var ve=["X","INVS","ALOL","ALOP","ALOG","LSER","ALOA","TOGL","PHOT"],de=[0,1,3,4,5,6,7,256,257],we=0,he=[2,1];e();var be=[];F(1),!function me(){y&&X>5&&(h(),X=0),X++,requestAnimationFrame(me)}(),window.selectOpt=m,window.selectPart=M,window.mouse_partOP=o}();