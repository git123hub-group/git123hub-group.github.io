/*
 The games source code's website is:
 https://git123hub.github.io/SimplePowder/ParticleToy.js
*/
var currentType=2,currentProp=0;!function(){function e(){for(var e,r=0;66>r;r++)for(var a=0;82>a;a++)t(a,r,g[e=(82*r+a)*R],g[e+G])}function r(e){var r=e*Y,a=0|L[r+1],n=0|L[r+2];I.fillStyle="#FFFFFF",I.fillRect(10*a,10*n,10,10)}function a(){I.clearRect(0,0,820,660);for(var e=0,a=0;N>a;e++)0!==L[e*Y]&&(a++,r(e))}function n(e,r,a){var n=(82*r+e)*R;return 0!==g[n]?!1:(g[n]=a,g[n+1]=0,g[n+2]=0,g[n+3]=0,g[n+4]=0,g[n+5]=0,g[n+6]=0,g[n+7]=0,!0)}function t(e,r,a,n){E.globalAlpha=1,E.clearRect(10*e,10*r,10,10),0!==a&&(E.fillStyle=K[a],E.fillRect(10*e,10*r,10,10),6!==a&&4278190080&n&&(E.globalAlpha=(n>>>24)/255,E.fillStyle="#"+(n>>>0).toString(16).slice(-6),E.fillRect(10*e,10*r,10,10)))}function o(e,a,o,i){var f,u,l,d=(82*a+e)*R;if(0>=i){if(0!==o){if(!n(e,a,o))return void(8!==g[d]&&11!==g[d]&&(g[d]<14||g[d]>16)&&(g[d+1]=o));(15==g[d]||16==g[d])&&(g[d+1]=re)}else g[d]=0;t(e,a,o,0)}else if(R>=i)0!==g[d]&&(g[d+i-1]=o,(1===i||i===G+10)&&t(e,a,o,g[d+G]));else if(i===R+1)if(256>o){var v=X[82*a+e];6===v&&(l=B[82*a+e],D--,O[4*l]=O[4*D],O[4*l+1]=O[4*D+1],O[4*l+2]=O[4*D+2],O[4*l+3]=O[4*D+3]),6===o&&(B[82*a+e]=D,O[4*D]=e,O[4*D+1]=a,u=4*Math.random()|0,O[4*D+2]=te[u],O[4*D+3]=oe[u],D++),0===o?(X[82*a+e]=0,C.clearRect(10*e,10*a,10,10)):(X[82*a+e]=o,C.fillStyle=ce[o-1],C.fillRect(10*e,10*a,10,10))}else if(!mouseEntered)switch(o){case 256:1===X[82*a+e]?c(e,a,1,2):2===X[82*a+e]&&c(e,a,2,1);break;case 257:u=4*Math.random()|0,f=s(e,a,te[u],oe[u],1),S[d=82*a+e]=f,r(f)}}function c(e,r,a,n){console.debug(n);var t,o,c,i,f=[e,r],u=2;do{for(c=82*(r=f[--u]),t=o=e=f[--u];t>=0&&X[c+t-1]===a;)t--;for(;82>o&&X[c+o+1]===a;)o++;for(C.fillStyle=ce[n-1],C.fillRect(10*t,10*r,10*(o-t+1),10),e=t;o>=e;e++)X[c+e]=n;if(r>=1)for(i=r-1,c-=82,e=t;o>=e;e++)X[c+e]===a&&(f[u++]=e,f[u++]=i);if(81>r)for(i=r+1,c+=164,e=t;o>=e;e++)X[c+e]===a&&(f[u++]=e,f[u++]=i)}while(u)}function i(e,r){return e>=0&&82>e&&r>=0&&66>r}function f(e,r,a,n){switch(X[82*r+e]){case 1:case 6:return!1;case 3:if(2!==z[a]&&0!==n)return!1;break;case 4:if(1!==z[a]&&0!==n)return!1;break;case 5:if(3!==z[a]&&4!==z[a]&&0!==n)return!1}return!0}function u(e,r){var a,n=g[(82*r+e)*R];if(f(e,r,n,0)){null!=ne[n]&&ne[n](e,r);var t,o,c,u,l=z[n],d=Math.random()<.5?1:-1,s=r+1,v=!1,w=!1;switch(l){case 1:for(t=0;1>=t;t=-2*t+1){if(o=i(c=e+t*d,s),u=g[(82*s+c)*R],!o||5===u){v=!0;break}if(f(c,s,n,1)&&Z[u]<Z[n]){w=!0,u=n,v=!0;break}}break;case 2:for(t=0;1>=t;t=-2*t+1){if(o=i(c=e+t*d,s),u=g[(82*s+c)*R],!o||5===u){v=!0;break}if(f(c,s,n,1)){if(Z[u]<Z[n]){w=!0,u=n,v=!0;break}1===t&&(s=r)}}break;case 3:if(o=i(c=e+Math.round(2.2*Math.random()-1.1),s=r+Math.round(2.2*Math.random()-1.1)),u=g[(82*s+c)*R],!o||5===u){v=!0;break}if(!f(c,s,n,1))return;if(0===u){w=!0,u=n,v=!0;break}break;case 4:for(t=1;t>=0;){if(o=i(c=e+(d=Math.round(2*Math.random()-1)),s=r-t--),u=g[(82*s+c)*R],!o||5===u){v=!0;break}if(!f(c,s,n,1))return;if(Z[u]<Z[n]){w=!0,u=n,v=!0;break}}}if(v)if(w){a=(82*s+c)*R;var m=g[a];if(m&&!f(e,r,m,2))return;for(var h=0;R>h;h++)t=g[d=a+h],g[d]=g[n=(82*r+e)*R+h],g[n]=t}else g[(82*r+e)*R]=0}}function l(e){var r=e*Y,a=0|L[r+1],n=0|L[r+2],t=a,o=n,c=0|L[r+3],f=0|L[r+4];return 1&L[r+5]?(L[r+5]&=-2,1):(a+=c,n+=f,i(a,n)?(0===g[(82*n+a)*R]&&(a+=c,n+=f),i(a,n)&&5!==g[(82*n+a)*R]?(v(e,t,o),S[tmp=82*n+a]=e,L[r+1]=a,L[r+2]=n,1):(d(e),v(e,t,o),0)):(d(e),v(e,t,o),0))}function d(e){L[e*Y]=0,L[e*Y+5]=_,_=e,N--}function s(e,r,a,n,t){var o,c=_;return _=L[(o=c*Y)+5],L[o++]=t,L[o++]=e,L[o++]=r,L[o++]=a,L[o++]=n,L[o++]=0,N++,c}function v(e,r,a){var n;S[n=82*a+r]===e&&(S[n]=-1)}function w(){for(var e,r,a=0;5412>a;a++)S[a]=-1;for(var a=0,n=0;N>n;a++)if(0!==L[a*Y]){n++;var t=a*Y;e=0|L[t+1],r=0|L[t+2],S[82*r+e]=a}}function m(){for(var r,n,t,o,c,i=0,f=0;D>f;f++)r=O[i++],n=O[i++],t=O[i++],o=O[i++],c=s(r,n,t,o,1),S[tmp=82*n+r]=c;for(var f=0,d=0;N>d;f++)0!==L[f*Y]&&(d+=l(f));for(var f=0;4500>f;f++)u(82*Math.random()|0,66*Math.random()|0);N>0&&w(),a(),e()}function h(e){for(var r=ue[e++],a=ue[e],n=0;15>n;n++)a>r?(fe[n]=r,document.getElementById("Menu_"+n).value=ie[r++]):(fe[n]=-1,document.getElementById("Menu_"+n).value="")}function b(e){switch(fe[e]){case 0:y=!y;break;case 1:y=!1,m();break;case 2:A(0);break;case 3:A(1);break;case 4:A(2);break;case 5:A(3);break;case 6:A(4);break;case 7:currentProp=R+1,currentType=ve[1],se=1;for(var r=4;15>r;r++)we[r]=-1,document.getElementById("Part_"+r).value="";for(var r=0;8>r;r++)we[r]=de[r],document.getElementById("Part_"+r).value=le[r];break;case 8:h(1);break;case 9:for(var a=["TPT","CNWL","ETRC","RETN"],r=0;15>r;r++)currentProp=-1,we[r]=r,document.getElementById("Part_"+r).value=4>r?a[r]:"";break;case 10:h(0);break;case 11:k(1);break;case 12:k(2);break;case 13:k(3);break;case 14:k(4);break;case 15:k(5);break;case 16:k(6);break;case 17:k(7);break;case 18:k(8)}}function k(e){var r=prompt("Change particle property");null!=r&&(currentProp=e,currentType="#"===r.charAt(0)||"0x"===r.substr(0,2)?parseInt(r.slice(-8),16):parseInt(r))}function M(e){if(currentProp>=0)e>=0&&(ve[se]=currentType=we[e]);else if(3>e){var r=["http://powdertoy.co.uk/","http://conwaylife.com/","SimplePowder/electronics","https://git123hub.github.io/index/"];location.href=r[e]}}function A(e){0!==currentProp&&(currentProp=0,se=0,currentType=ve[0]);for(var r,a=0,n=0;15>n;n++)we[n]=-1,document.getElementById("Part_"+n).value="";for(var n=0;$>n;n++)J[n]===e&&(we[a]=n,a++);for(var n=0;15>n&&a>n;n++)r=we[n],document.getElementById("Part_"+n).value=U[r]}for(var y,F=document.getElementById("InvisLayer"),p=document.getElementById("PartLayer"),P=document.getElementById("PhotonsLayer"),C=F.getContext("2d"),E=p.getContext("2d"),I=P.getContext("2d"),R=8,Y=6,T=0,X=new Uint8Array(5412),g=new Int32Array(5412*R),S=new Int16Array(5412),L=new Int16Array(6e3*Y),B=new Int16Array(5412),O=new Int8Array(2e3),D=0,N=0,_=0,G=R-2,W=R-1,x=R-3,V=0;82>V;V++)g[V*R]=1,g[(V+5330)*R]=1;for(var V=0;66>V;V++)g[82*V*R]=1,g[(82*V+81)*R]=1;for(var V=0;5999>V;)L[V*Y+5]=++V;L[5999*Y+5]=-1;for(var V=0;5412>V;V++)S[V]=-1;var U=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE","WOOD","WTRV","BASE","SLTW","SALT","STNE","PLNT"],K=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000","#BF9C1D","#A0A0FF","#13BDFF","#505CD4","#FFFFFF","#999999","#0CAC00"],q=[0,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,1,0,0],H=[0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],Q=[0,0,1,0,0,0,1,1,0,.2,1,0,1,1,0,0,0,0,1],j=[0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],z=[0,0,1,2,0,0,2,2,2,2,2,4,0,4,2,2,1,0,0],J=[4,4,1,2,4,4,2,2,2,2,2,3,0,3,2,2,1,0,0],Z=[0,1e3,800,400,1e3,0,420,420,390,300,900,1,1e3,1,390,440,900,1e3,1e3],$=19,ee=30,re=50,ae=re,ne=[null,null,null,null,function(e,r){var a,t=(82*r+e)*R+1;if(0!==(a=g[t])){var o=e+(3*Math.random()|0)-1,c=r+(3*Math.random()|0)-1;i(o,c)&&n(o,c,a)}else e:for(var f=-1;2>f;f++)for(var u=-1;2>u;u++)if(i(o=e+f,c=r+u)&&(a=g[(82*c+o)*R],q[a])){g[t]=a;break e}},null,function(e,r){var a,n,t,o,c=(82*r+e)*R;if(g[c+W]>0){for(var f=0;4>f;f++)a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,i(a,n)&&(t=(82*n+a)*R,6===g[t]&&g[t+W]<=0&&(g[t+W]=g[c+W]+2));return void(--g[c+W]||(g[c]=g[c+x],g[c+x]=0))}a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,i(a,n)&&(t=(82*n+a)*R,o=g[t],7===o?(g[t]=0,g[c+W]=30):H[o]&&(g[t]=6,g[t+x]=o,g[t+W]=0))},null,function(e,r){var a,n,t=(82*r+e)*R+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!i(newX,newY))return;switch(a=(82*newY+newX)*R,n=g[a]){case 3:return n=g[t]+ee>>1,g[a]=8,void(g[a+1]=g[t]=n);case 8:return void(g[t]>=ee?g[t-1]=0:(n=g[a+1]-g[t]>>1,g[a+1]-=n,g[t]+=n))}Math.random()<Q[n]&&(g[a]=0,g[t]+=2)}},null,null,function(e,r){var a,n=(82*r+e)*R+1;g[n]>18&&(g[n-1]=0);for(var t=0;2>t;t++)if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var o=(82*newY+newX)*R,c=!0;do{if(a=g[o],3===a){2.5*Math.random()-1.25>newY-r?g[o]=13:g[n-1]=0;break}if(15===a){2.5*Math.random()-1.25>newY-r?(ae+=g[o+1],ae>=2*re?(g[o]=16,g[o+1]=re,ae-=2*re):g[o]=13):g[n-1]=0;break}if(j[a]&&c){g[o]=11,g[o+1]=0;break}if(o-=82*R,0>o)break;c=!c}while(!c)}g[n]++},null,function(e,r){var a=(82*r+e)*R;if(!(1>r)){var n=(82*(r-1)+e)*R;17===g[n]&&(g[a]=3)}},function(e,r){var a,n,t,o=(82*r+e)*R+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!i(newX,newY))return;switch(a=(82*newY+newX)*R,n=g[a]){case 3:return n=g[o]+ee>>1,g[a]=14,void(g[a+1]=g[o]=n);case 7:return;case 8:return t=g[a+1]-g[o],t>=0?(g[a]=15,g[a+1]=re):g[a+1]=30+t,void(0>=t?(g[o-1]=15,g[o]=re):g[o]=30-t);case 9:return g[o]+=8,g[a]=7,void(g[o]>=ee&&(g[o-1]=0));case 14:return void(g[o]>=ee?g[o-1]=0:(n=g[a+1]-g[o]>>1,g[a+1]-=n,g[o]+=n))}Math.random()<Q[n]&&(g[a]=0,g[o]+=2)}},function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)&&(newX!=e||newY!=r)){var a,n,t=(82*r+e)*R+1,o=(82*newY+newX)*R;switch(g[o]){case 3:a=g[t],n=a>>1,a-=n,n>0?g[t]=n:g[t-1]=3,g[o]=15,g[o+1]=a;break;case 15:a=g[t]+g[o+1],n=a>>1,g[o+1]=a-n,g[t]=n;break;case 16:a=g[t]+g[o+1],g[t]=re,a>re?g[o+1]=a-re:(g[o]=15,g[o+1]=a)}}},function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var a=(82*r+e)*R,n=(82*newY+newX)*R;3===g[n]&&(g[a]=15,g[n]=15,g[n+1]=re)}},null,function(e,r){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,i(newX,newY)){var a=(82*r+e)*R,n=(82*newY+newX)*R;if(Math.random()<.2)switch(g[n]){case 3:g[n]=18;break;case 15:g[a]=0}}}],te=[1,0,-1,0],oe=[0,1,0,-1],ce=["#00CCCC","#0F0064","#555577","#775555","#557755","#885088"],ie=["PAUS","FRAM","SOLD","PWDR","LIQD","GAS","SPEC","INVS","PROP","LINK","BACK","TYPE","CTYP","ARG3","ARG4","ARG5","ARG6","DECO","TMP"],fe=[],ue=[0,10,19];h(0);var le=["X","INVS","ALOL","ALOP","ALOG","LSER","TOGL","PHOT"],de=[0,1,3,4,5,6,256,257],se=0,ve=[2,1];e();var we=[];A(1),!function me(){y&&T>5&&(m(),T=0),T++,requestAnimationFrame(me)}(),window.selectOpt=b,window.selectPart=M,window.mouse_partOP=o}();