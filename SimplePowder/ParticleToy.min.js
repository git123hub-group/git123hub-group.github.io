var currentType=2,currentProp=0;!function(){function e(){for(var e,r=0;66>r;r++)for(var a=0;82>a;a++)t(a,r,B[e=(82*r+a)*F],B[e+4])}function r(e){var r=e*g,a=0|L[r+2],n=0|L[r+3];E.fillStyle="#FFFFFF",E.fillRect(10*a,10*n,10,10)}function a(){E.clearRect(0,0,820,660);for(var e=0,a=0;O>a;e++)0!==L[e*g]&&(a++,r(e))}function n(e,r,a){var n=(82*r+e)*F;return 0!==B[n]?!1:(B[n]=a,B[n+1]=0,B[n+2]=0,B[n+3]=0,B[n+4]=0,B[n+5]=0,!0)}function t(e,r,a,n){C.globalAlpha=1,C.clearRect(10*e,10*r,10,10),0!==a&&(C.fillStyle=_[a],C.fillRect(10*e,10*r,10,10),6!==a&&4278190080&n&&(C.globalAlpha=(n>>>24)/255,C.fillStyle="#"+(n>>>0).toString(16).slice(-6),C.fillRect(10*e,10*r,10,10)))}function o(e,a,o,c){var i,l=(82*a+e)*F;if(0>=c){if(0!==o){if(!n(e,a,o))return void(8!==B[l]&&11!==B[l]&&(B[l+1]=o))}else B[l]=0;t(e,a,o,0)}else if(6>=c)0!==B[l]&&(B[l+c-1]=o,(1===c||5===c)&&t(e,a,o,B[l+4]));else if(7===c)if(0===o)T[82*a+e]=0,I.clearRect(10*e,10*a,10,10);else if(256>o)T[82*a+e]=o,I.fillStyle=Q[o-1],I.fillRect(10*e,10*a,10,10);else if(!mouseEntered)switch(o){case 256:1===T[82*a+e]?f(e,a,1,2):2===T[82*a+e]&&f(e,a,2,1);break;case 257:i=d(e,a,4*Math.random(),1),S[l=82*a+e]=i,r(i)}}function f(e,r,a,n){console.debug(n);var t,o,f,c,i=[e,r],l=2;do{for(f=82*(r=i[--l]),t=o=e=i[--l];t>=0&&T[f+t-1]===a;)t--;for(;82>o&&T[f+o+1]===a;)o++;for(I.fillStyle=Q[n-1],I.fillRect(10*t,10*r,10*(o-t+1),10),e=t;o>=e;e++)T[f+e]=n;if(r>=1)for(c=r-1,f-=82,e=t;o>=e;e++)T[f+e]===a&&(i[l++]=e,i[l++]=c);if(81>r)for(c=r+1,f+=164,e=t;o>=e;e++)T[f+e]===a&&(i[l++]=e,i[l++]=c)}while(l)}function c(e,r){return e>=0&&82>e&&r>=0&&66>r}function i(e,r){if(1!==T[82*r+e]){var a=B[(82*r+e)*F];null!=H[a]&&H[a](e,r);var n,t,o,f,i=G[a],l=Math.random()<.5?1:-1,u=r+1,d=!1,v=!1;switch(i){case 1:for(n=0;1>=n;n=-2*n+1){if(t=c(o=e+n*l,u),f=B[(82*u+o)*F],!t||5===f){d=!0;break}if(K[f]<K[a]){v=!0,f=a,d=!0;break}}break;case 2:for(n=0;1>=n;n=-2*n+1){if(t=c(o=e+n*l,u),f=B[(82*u+o)*F],!t||5===f){d=!0;break}if(K[f]<K[a]){v=!0,f=a,d=!0;break}1===n&&(u=r)}break;case 3:if(t=c(o=e+Math.round(2.2*Math.random()-1.1),u=r+Math.round(2.2*Math.random()-1.1)),f=B[(82*u+o)*F],!t||5===f){d=!0;break}if(0===f){v=!0,f=a,d=!0;break}break;case 4:for(n=1;n>=0;){if(t=c(o=e+(l=Math.round(2*Math.random()-1)),u=r-n--),f=B[(82*u+o)*F],!t||5===f){d=!0;break}if(K[f]<K[a]){v=!0,f=a,d=!0;break}}}if(d)if(v)for(var s=0;F>s;s++)n=B[l=(82*u+o)*F+s],B[l]=B[a=(82*r+e)*F+s],B[a]=n;else B[(82*r+e)*F]=0}}function l(e){var r=e*g,a=3&L[r+1],n=0|L[r+2],t=0|L[r+3],o=n,f=t,i=j[a],l=z[a];return n+=i,t+=l,c(n,t)?(0===B[(82*t+n)*F]&&(n+=i,t+=l),c(n,t)?(v(e,o,f),S[tmp=82*t+n]=e,L[r+2]=n,void(L[r+3]=t)):(u(e),void v(e,o,f))):(u(e),void v(e,o,f))}function u(e){L[e*g]=0,L[e*g+1]=D,D=e,O--}function d(e,r,a,n){var t,o=D;return D=L[(t=o*g)+1],L[t++]=n,L[t++]=a,L[t++]=e,L[t]=r,O++,o}function v(e,r,a){var n;S[n=82*a+r]===e&&(S[n]=-1)}function s(){for(var e,r,a=0;5412>a;a++)S[a]=-1;for(var a=0,n=0;O>n;a++)if(0!==L[a*g]){n++;var t=a*g;e=0|L[t+2],r=0|L[t+3],S[82*r+e]=a}}function m(){for(var r=0,n=0;O>n;r++)0!==L[r*g]&&(n++,l(r));for(var r=0;4500>r;r++)i(82*Math.random()|0,66*Math.random()|0);O>0&&s(),a(),e()}function h(e){for(var r=$[e++],a=$[e],n=0;15>n;n++)a>r?(Z[n]=r,document.getElementById("Menu_"+n).value=J[r++]):(Z[n]=-1,document.getElementById("Menu_"+n).value="")}function b(e){switch(Z[e]){case 0:p=!p;break;case 1:p=!1,m();break;case 2:w(0);break;case 3:w(1);break;case 4:w(2);break;case 5:w(3);break;case 6:w(4);break;case 7:currentProp=7,currentType=ne[1],ae=1;for(var r=4;15>r;r++)te[r]=-1,document.getElementById("Part_"+r).value="";for(var r=0;4>r;r++)te[r]=re[r],document.getElementById("Part_"+r).value=ee[r];break;case 8:h(1);break;case 9:for(var a=["TPT","CNWL","RETN"],r=0;15>r;r++)currentProp=-1,te[r]=r,document.getElementById("Part_"+r).value=3>r?a[r]:"";break;case 10:h(0);break;case 11:k(1);break;case 12:k(2);break;case 13:k(3);break;case 14:k(4);break;case 15:k(5);break;case 16:k(6)}}function k(e){var r=prompt("Change particle property");null!=r&&(currentProp=e,currentType="#"===r.charAt(0)||"0x"===r.substr(0,2)?parseInt(r.slice(-8),16):parseInt(r))}function y(e){if(currentProp>=0)e>=0&&(ne[ae]=currentType=te[e]);else if(3>e){var r=["http://powdertoy.co.uk/","http://conwaylife.com/","https://git123hub.github.io/index/"];location.href=r[e]}}function w(e){0!==currentProp&&(currentProp=0,ae=0,currentType=ne[0]);for(var r,a=0,n=0;15>n;n++)te[n]=-1,document.getElementById("Part_"+n).value="";for(var n=0;q>n;n++)U[n]===e&&(te[a]=n,a++);for(var n=0;15>n&&a>n;n++)r=te[n],document.getElementById("Part_"+n).value=X[r]}for(var p,A=document.getElementById("InvisLayer"),M=document.getElementById("PartLayer"),P=document.getElementById("PhotonsLayer"),I=A.getContext("2d"),C=M.getContext("2d"),E=P.getContext("2d"),F=6,g=4,R=0,T=new Uint8Array(5412),B=new Int32Array(5412*F),S=new Int16Array(5412),L=new Int16Array(6e3*g),O=0,D=0,Y=0;82>Y;Y++)B[Y*F]=1,B[(Y+5330)*F]=1;for(var Y=0;66>Y;Y++)B[82*Y*F]=1,B[(82*Y+81)*F]=1;for(var Y=0;5999>Y;)L[4*Y+1]=++Y;L[23997]=-1;for(var Y=0;5412>Y;Y++)S[Y]=-1;var X=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE","WOOD","WTRV"],_=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000","#bf9c1d","#A0A0FF"],N=[0,0,1,1,0,0,1,1,1,1,1,1,0,1],x=[0,0,1,1,1,1,0,0,1,1,1,1,1,1],V=[0,0,1,0,0,0,1,1,0,.2,1,0,1,1],W=[0,0,1,0,0,0,0,0,0,1,0,0,1,0],G=[0,0,1,2,0,0,2,2,2,2,2,4,0,4],U=[4,4,1,2,4,4,2,2,2,2,2,3,0,3],K=[0,1e3,800,400,1e3,0,420,420,390,300,900,1,1e3,1],q=14,H=[null,null,null,null,function(e,r){var a,t=(82*r+e)*F+1;if(0!==(a=B[t])){var o=e+(3*Math.random()|0)-1,f=r+(3*Math.random()|0)-1;c(o,f)&&n(o,f,a)}else e:for(var i=-1;2>i;i++)for(var l=-1;2>l;l++)if(c(o=e+i,f=r+l)&&(a=B[(82*f+o)*F],N[a])){B[t]=a;break e}},null,function(e,r){var a,n,t,o,f=(82*r+e)*F;if(B[f+5]>0){for(var i=0;4>i;i++)a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,c(a,n)&&(t=(82*n+a)*F,6===B[t]&&B[t+5]<=0&&(B[t+5]=B[f+5]+2));return void(--B[f+5]||(B[f]=B[f+3],B[f+3]=0))}a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,c(a,n)&&(t=(82*n+a)*F,o=B[t],7===o?(B[t]=0,B[f+5]=30):x[o]&&(B[t]=6,B[t+3]=o,B[t+5]=0),console.log(B[f+5]))},null,function(e,r){var a,n,t=30,o=(82*r+e)*F+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!c(newX,newY))return;if(a=(82*newY+newX)*F,n=B[a],3===n)return n=B[o]+t>>1,B[a]=8,void(B[a+1]=B[o]=n);if(8===n)return void(B[o]>=t?B[o-1]=0:(n=B[a+1]-B[o]>>1,B[a+1]-=n,B[o]+=n));Math.random()<V[n]&&(B[a]=0,B[o]+=2)}},null,null,function(e,r){var a,n=(82*r+e)*F+1;B[n]>18&&(B[n-1]=0);for(var t=0;2>t;t++)if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,c(newX,newY)){var o=(82*newY+newX)*F;a=B[o],3===a?newY<r?B[o]=13:B[n-1]=0:W[a]&&(B[o]=11,B[o+1]=0)}B[n]++},null,null],Q=["#00CCCC","#0F0064"],j=[1,0,-1,0],z=[0,-1,0,1],J=["PAUS","FRAM","SOLD","PWDR","LIQD","GAS","SPEC","INVS","PROP","LINK","BACK","TYPE","CTYP","ARG3","ARG4","DECO","TMP"],Z=[],$=[0,10,17];h(0);var ee=["X","INVS","TOGL","PHOT"],re=[0,1,256,257],ae=0,ne=[2,1];e();var te=[];w(1),!function oe(){p&&R>5&&(m(),R=0),R++,requestAnimationFrame(oe)}(),window.selectOpt=b,window.selectPart=y,window.mouse_partOP=o}();