var currentType=2,currentProp=0;!function(){function e(){for(var e,r=0;66>r;r++)for(var a=0;82>a;a++)t(a,r,S[e=(82*r+a)*E],S[e+4])}function r(e){var r=e*g,a=0|_[r+2],n=0|_[r+3];I.fillStyle="#FFFFFF",I.fillRect(10*a,10*n,10,10)}function a(){I.clearRect(0,0,820,660);for(var e=0,a=0;L>a;e++)0!==_[e*g]&&(a++,r(e))}function n(e,r,a){var n=(82*r+e)*E;return 0!==S[n]?!1:(S[n]=a,S[n+1]=0,S[n+2]=0,S[n+3]=0,S[n+4]=0,S[n+5]=0,!0)}function t(e,r,a,n){F.globalAlpha=1,F.clearRect(10*e,10*r,10,10),0!==a&&(F.fillStyle=X[a],F.fillRect(10*e,10*r,10,10),6!==a&&4278190080&n&&(F.globalAlpha=(n>>>24)/255,F.fillStyle="#"+(n>>>0).toString(16).slice(-6),F.fillRect(10*e,10*r,10,10)))}function o(e,a,o,f){var c,u=(82*a+e)*E;if(0>=f){if(0!==o){if(!n(e,a,o))return void(8!==S[u]&&11!==S[u]&&(S[u+1]=o))}else S[u]=0;t(e,a,o,0)}else if(6>=f)0!==S[u]&&(S[u+f-1]=o,(1===f||5===f)&&t(e,a,o,S[u+4]));else if(7===f)if(0===o)T[82*a+e]=0,P.clearRect(10*e,10*a,10,10);else if(256>o)T[82*a+e]=o,P.fillStyle=Q[o-1],P.fillRect(10*e,10*a,10,10);else if(!mouseEntered)switch(o){case 256:1===T[82*a+e]?i(e,a,1,2):2===T[82*a+e]&&i(e,a,2,1);break;case 257:c=v(e,a,4*Math.random(),1),B[u=82*a+e]=c,r(c)}}function i(e,r,a,n){console.debug(n);var t,o,i,f,c=[e,r],u=2;do{for(i=82*(r=c[--u]),t=o=e=c[--u];t>=0&&T[i+t-1]===a;)t--;for(;82>o&&T[i+o+1]===a;)o++;for(P.fillStyle=Q[n-1],P.fillRect(10*t,10*r,10*(o-t+1),10),e=t;o>=e;e++)T[i+e]=n;if(r>=1)for(f=r-1,i-=82,e=t;o>=e;e++)T[i+e]===a&&(c[u++]=e,c[u++]=f);if(81>r)for(f=r+1,i+=164,e=t;o>=e;e++)T[i+e]===a&&(c[u++]=e,c[u++]=f)}while(u)}function f(e,r){return e>=0&&82>e&&r>=0&&66>r}function c(e,r){if(1!==T[82*r+e]){var a=S[(82*r+e)*E];null!=H[a]&&H[a](e,r);var n,t,o,i,c=G[a],u=Math.random()<.5?1:-1,l=r+1,v=!1,s=!1;switch(c){case 1:for(n=0;1>=n;n=-2*n+1){if(t=f(o=e+n*u,l),i=S[(82*l+o)*E],!t||5===i){v=!0;break}if(K[i]<K[a]){s=!0,i=a,v=!0;break}}break;case 2:for(n=0;1>=n;n=-2*n+1){if(t=f(o=e+n*u,l),i=S[(82*l+o)*E],!t||5===i){v=!0;break}if(K[i]<K[a]){s=!0,i=a,v=!0;break}1===n&&(l=r)}break;case 3:if(t=f(o=e+Math.round(2.2*Math.random()-1.1),l=r+Math.round(2.2*Math.random()-1.1)),i=S[(82*l+o)*E],!t||5===i){v=!0;break}if(0===i){s=!0,i=a,v=!0;break}break;case 4:for(n=1;n>=0;){if(t=f(o=e+(u=Math.round(2*Math.random()-1)),l=r-n--),i=S[(82*l+o)*E],!t||5===i){v=!0;break}if(K[i]<K[a]){s=!0,i=a,v=!0;break}}}if(v)if(s)for(var d=0;E>d;d++)n=S[u=(82*l+o)*E+d],S[u]=S[a=(82*r+e)*E+d],S[a]=n;else S[(82*r+e)*E]=0}}function u(e){var r=e*g,a=3&_[r+1],n=0|_[r+2],t=0|_[r+3],o=n,i=t,c=j[a],u=z[a];return n+=c,t+=u,f(n,t)?(0===S[(82*t+n)*E]&&(n+=c,t+=u),f(n,t)?(s(e,o,i),B[tmp=82*t+n]=e,_[r+2]=n,void(_[r+3]=t)):(l(e),void s(e,o,i))):(l(e),void s(e,o,i))}function l(e){_[e*g]=0,_[e*g+1]=O,O=e,L--}function v(e,r,a,n){var t,o=O;return O=_[(t=o*g)+1],_[t++]=n,_[t++]=a,_[t++]=e,_[t]=r,L++,o}function s(e,r,a){var n;B[n=82*a+r]===e&&(B[n]=-1)}function d(){for(var e,r,a=0;5412>a;a++)B[a]=-1;for(var a=0,n=0;L>n;a++)if(0!==_[a*g]){n++;var t=a*g;e=0|_[t+2],r=0|_[t+3],B[82*r+e]=a}}function m(){for(var r=0,n=0;L>n;r++)0!==_[r*g]&&(n++,u(r));for(var r=0;4500>r;r++)c(82*Math.random()|0,66*Math.random()|0);L>0&&d(),a(),e()}function h(e){for(var r=$[e++],a=$[e],n=0;15>n;n++)a>r?(Z[n]=r,document.getElementById("Menu_"+n).value=J[r++]):(Z[n]=-1,document.getElementById("Menu_"+n).value="")}function p(e){switch(Z[e]){case 0:k=!k;break;case 1:k=!1,m();break;case 2:y(0);break;case 3:y(1);break;case 4:y(2);break;case 5:y(3);break;case 6:y(4);break;case 7:currentProp=7,currentType=ne[1],ae=1;for(var r=4;15>r;r++)te[r]=-1,document.getElementById("Part_"+r).value="";for(var r=0;4>r;r++)te[r]=re[r],document.getElementById("Part_"+r).value=ee[r];break;case 8:h(1);break;case 9:for(var a=["TPT","CNWL","ETRC","RETN"],r=0;15>r;r++)currentProp=-1,te[r]=r,document.getElementById("Part_"+r).value=4>r?a[r]:"";break;case 10:h(0);break;case 11:w(1);break;case 12:w(2);break;case 13:w(3);break;case 14:w(4);break;case 15:w(5);break;case 16:w(6)}}function w(e){var r=prompt("Change particle property");null!=r&&(currentProp=e,currentType="#"===r.charAt(0)||"0x"===r.substr(0,2)?parseInt(r.slice(-8),16):parseInt(r))}function b(e){if(currentProp>=0)e>=0&&(ne[ae]=currentType=te[e]);else if(3>e){var r=["http://powdertoy.co.uk/","http://conwaylife.com/","SimplePowder/electronics","https://git123hub.github.io/index/"];location.href=r[e]}}function y(e){0!==currentProp&&(currentProp=0,ae=0,currentType=ne[0]);for(var r,a=0,n=0;15>n;n++)te[n]=-1,document.getElementById("Part_"+n).value="";for(var n=0;q>n;n++)U[n]===e&&(te[a]=n,a++);for(var n=0;15>n&&a>n;n++)r=te[n],document.getElementById("Part_"+n).value=Y[r]}for(var k,A=document.getElementById("InvisLayer"),M=document.getElementById("PartLayer"),C=document.getElementById("PhotonsLayer"),P=A.getContext("2d"),F=M.getContext("2d"),I=C.getContext("2d"),E=6,g=4,R=0,T=new Uint8Array(5412),S=new Int32Array(5412*E),B=new Int16Array(5412),_=new Int16Array(6e3*g),L=0,O=0,D=0;82>D;D++)S[D*E]=1,S[(D+5330)*E]=1;for(var D=0;66>D;D++)S[82*D*E]=1,S[(82*D+81)*E]=1;for(var D=0;5999>D;)_[4*D+1]=++D;_[23997]=-1;for(var D=0;5412>D;D++)B[D]=-1;var Y=["X","BLCK","DUST","WATR","CLNE","VOID","VIRS","CURE","ACID","OIL","MERC","FIRE","WOOD","WTRV"],X=["#000000","#AAAAAA","#FFE0A0","#2030D0","#CCCC00","#790B0B","#FE11F6","#F5F5DC","#EE66FF","#483810","#746A6A","#FF0000","#bf9c1d","#A0A0FF"],x=[0,0,1,1,0,0,1,1,1,1,1,1,0,1],N=[0,0,1,1,1,1,0,0,1,1,1,1,1,1],V=[0,0,1,0,0,0,1,1,0,.2,1,0,1,1],W=[0,0,1,0,0,0,0,0,0,1,0,0,1,0],G=[0,0,1,2,0,0,2,2,2,2,2,4,0,4],U=[4,4,1,2,4,4,2,2,2,2,2,3,0,3],K=[0,1e3,800,400,1e3,0,420,420,390,300,900,1,1e3,1],q=14,H=[null,null,null,null,function(e,r){var a,t=(82*r+e)*E+1;if(0!==(a=S[t])){var o=e+(3*Math.random()|0)-1,i=r+(3*Math.random()|0)-1;f(o,i)&&n(o,i,a)}else e:for(var c=-1;2>c;c++)for(var u=-1;2>u;u++)if(f(o=e+c,i=r+u)&&(a=S[(82*i+o)*E],x[a])){S[t]=a;break e}},null,function(e,r){var a,n,t,o,i=(82*r+e)*E;if(S[i+5]>0){for(var c=0;4>c;c++)a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,f(a,n)&&(t=(82*n+a)*E,6===S[t]&&S[t+5]<=0&&(S[t+5]=S[i+5]+2));return void(--S[i+5]||(S[i]=S[i+3],S[i+3]=0))}a=e+(3*Math.random()|0)-1,n=r+(3*Math.random()|0)-1,f(a,n)&&(t=(82*n+a)*E,o=S[t],7===o?(S[t]=0,S[i+5]=30):N[o]&&(S[t]=6,S[t+3]=o,S[t+5]=0),console.log(S[i+5]))},null,function(e,r){var a,n,t=30,o=(82*r+e)*E+1;if(.6<Math.random()){if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,!f(newX,newY))return;if(a=(82*newY+newX)*E,n=S[a],3===n)return n=S[o]+t>>1,S[a]=8,void(S[a+1]=S[o]=n);if(8===n)return void(S[o]>=t?S[o-1]=0:(n=S[a+1]-S[o]>>1,S[a+1]-=n,S[o]+=n));Math.random()<V[n]&&(S[a]=0,S[o]+=2)}},null,null,function(e,r){var a,n=(82*r+e)*E+1;S[n]>18&&(S[n-1]=0);for(var t=0;2>t;t++)if(newX=e+(3*Math.random()|0)-1,newY=r+(3*Math.random()|0)-1,f(newX,newY)){var o=(82*newY+newX)*E;a=S[o],3===a?newY<r?S[o]=13:S[n-1]=0:W[a]&&(S[o]=11,S[o+1]=0)}S[n]++},null,null],Q=["#00CCCC","#0F0064"],j=[1,0,-1,0],z=[0,-1,0,1],J=["PAUS","FRAM","SOLD","PWDR","LIQD","GAS","SPEC","INVS","PROP","LINK","BACK","TYPE","CTYP","ARG3","ARG4","DECO","TMP"],Z=[],$=[0,10,17];h(0);var ee=["X","INVS","TOGL","PHOT"],re=[0,1,256,257],ae=0,ne=[2,1];e();var te=[];y(1),!function oe(){k&&R>5&&(m(),R=0),R++,requestAnimationFrame(oe)}(),window.selectOpt=p,window.selectPart=b,window.mouse_partOP=o}();
