var part_state=1,paused=!0;!function(){function e(e,n){e>=82&&(e=81),n>=66&&(n=65);var t=l[n+1][e+1];if(part_state!==d)part_state?l[n+1][e+1][0]||(t[0]=part_state,t[1]=0,t[3]=0,a(e+1,n+1,t)):(t[0]=0,a(e+1,n+1,t));else{if(ctype=t[0],!t[1]&&ctype===S)return c(e+1,n+1,ctype),i();r(e+1,n+1,t),a(e+1,n+1,t)}}function r(e,r,a,i){ctype=a[0],P[ctype]&&a[1]<=0&&(a[2]=ctype,a[0]=d,a[1]=4)}function a(e,r,a){var i;p.fillStyle=w[a[0]],a[0]===I&&a[1]&&(5!==a[2]?p.fillStyle="rgb("+(i=15.95*a[1]|0)+","+i+","+i+")":p.fillStyle="rgb("+(i=100*a[1]|0)+","+3*i/5+","+i/5+")"),p.fillRect(10*(e-1),10*(r-1),10,10)}function i(){for(var e=1;67>e;e++)for(var r=1;83>r;r++)a(r,e,l[e][r])}function n(){for(var e,r,a,n=0;v>n;n++){e=4*n*s;for(var t=0;s>t;t++)if((a=l[n][t])[1])switch(a[1]--,a[0]){case I:a[1]||(a[0]=0);break;case _:5==a[3]&&(a[0]=g,a[1]=4,a[2]=C),a[3]=0;break;case C:5==a[3]&&(a[0]=g,a[1]=4,a[2]=C),a[3]=0}}for(r=0;v>r;r++)l[r][0][0]=0,l[r][s-1][0]=0;for(r=0;s>r;r++)l[0][r][0]=0,l[v-1][r][0]=0;for(var n=0;v>n;n++){a=l[n];for(var t=0;s>t;t++)f(t,n,a[t])}i()}function t(e,r){return e>=0&&s>e&&r>=0&&v>r}function f(e,a,i){var n,f,o,u,b,F,k,p,w,B,E,R,j,z,G,H,J=i[0],K=Math.min(2,e),N=Math.min(2,a),O=Math.min(2,s-e-3),Q=Math.min(2,v-a-3);switch(J){case d:if(!i[1])return i[1]=4,void(i[0]=i[2]);if(i[1]>=4)return;for(var T=-N;Q>=T;T++){k=l[f=a+T];for(var U=-K;O>=U;U++)if(!((U>0?U:-U)+(T>0?T:-T)>=4)){switch(p=k[n=e+U],w=i[2],B=p[0],w){case _:(B===y||B===_)&&r(n,f,p);continue;case M:(B===M||B===m||B===A)&&r(n,f,p);continue;case S:B===A&&r(n,f,p);continue}switch(B){case d:switch(p[2]){case _:w===A&&(p[0]=g,p[1]=5,p[2]=C)}continue;case m:if(w===A)continue;break;case C:w===m&&(p[0]=g,p[1]=5,p[2]=_);break;case _:if(w!==y){w===A&&(p[0]=g,p[1]=5,p[2]=C);continue}break;case g:p[2]===_&&p[1]<5&&(w===y?(p[0]=d,p[1]=4):w===A&&(p[1]=5,p[2]=C));continue;case M:(w===m||w===A)&&r(n,f,p);continue;case S:w===m&&c(n,f,B);continue}l[a+f>>1][e+n>>1][0]!==h&&r(n,f,p)}}break;case g:if(i[1]<=0)return void(i[0]=i[2]);if(i[1]>1&&i[1]<5)for(var T=-N;Q>=T;T++){k=l[a+T];for(var U=-K;O>=U;U++)(U>0?U:-U)+(T>0?T:-T)>=4||(p=k[n=e+U],(q[p[0]]||p[0]===d&&q[p[2]]||p[0]===g&&p[2]==_&&i[2]==C)&&(p[2]=i[2],p[0]=g,p[1]=5))}break;case x:for(var T=-N;Q>=T;T++){k=l[f=a+T];for(var U=-K;O>=U;U++)(U>0?U:-U)+(T>0?T:-T)>=4||(p=k[n=e+U],l[a+f>>1][e+n>>1][0]!==h&&p[0]!==M&&r(n=e+U,f,p))}break;case D:b=-4;for(var T=-1;2>T;T++){k=l[f=a+T];for(var U=-1;2>U;U++,b++)if(p=k[n=e+U],p[0]===d&&3===p[1]&&b)for(F=0>b?-b:b,E=-U,R=-T,j=e+E,z=a+R,G=p[2]===S,H=p[2]===m;t(j,z);){if(o=(u=l[z][j])[0]){if(H){if(q[u[0]]&&(u[3]|=1<<F-1),u[0]===M||u[0]===d&&u[2]===M||u[0]===D||u[0]===_||u[0]===g&&u[2]===_){j+=E,z+=R;continue}if(u[0]===I){u[1]=1,u[2]=5,j+=E,z+=R;continue}break}if(u[0]===M||u[0]===d&&u[2]===M||u[0]===D||u[0]===_||u[0]===g&&u[2]===_){j+=E,z+=R;continue}if(u[0]===I){if(u[1]){if(u[2]===F){u[1]=16,j+=E,z+=R;continue}5!==u[2]&&(u[1]=0);break}j+=E,z+=R;continue}if(r(j,z,u),!G||u[0]!==d||!P[u[2]])break}else u[0]=I,u[1]=H?2:16,u[2]=H?5:F;j+=E,z+=R}}break;case L:if(!i[1])for(var V=[-4,4,0,0],W=[0,0,-4,4],X=0;4>X;X++)U=V[X],T=W[X],t(e+U,a+T)&&(p=l[a+T][e+U])[0]==d&&p[1]<4&&r(e,a,i)}}function o(e,r){return r[0]===e||r[0]===d&&r[2]===e}function c(e,r,a){if(l[r][e][1])return 0;var i,n,t,f,c,u,v,b,F,k,p,w,y=[e],h=[r],m=1;do{for(p=w=e=y[--m],r=h[m],F=l[r];(v=p-1)>=0&&F[v][0]===a&&!F[v][1];)p=v;for(;(b=w+1)<s&&F[b][0]===a&&!F[b][1];)w=b;for(k=p;w>=k;k++)F[k][0]=d,F[k][1]=4,F[k][2]=a;if(f=r-1,i=l[f],c=r+1,n=l[c],p===w&&o(a,i[e-1])&&o(a,i[e+1])&&o(a,i[e])&&o(a,(t=l[u=r-2])[e])&&!o(a,t[e-1])&&!o(a,t[e+1]))t[e][0]!==a||t[e][1]||(y[m]=e,h[m++]=u);else for(k=p;w>=k;k++)i[k][0]!==a||i[k][1]||(k===p||k===w||!o(a,n[k])||o(a,n[k+1])||o(a,n[k-1]))&&(y[m]=k,h[m++]=f);if(p===w&&o(a,n[e-1])&&o(a,n[e+1])&&o(a,n[e])&&o(a,(t=l[u=r+2])[e])&&!o(a,t[e-1])&&!o(a,t[e+1]))t[e][0]!==a||t[e][1]||(y[m]=e,h[m++]=u);else for(k=p;w>=k;k++)n[k][0]!==a||n[k][1]||(k===p||k===w||!o(a,i[k])||o(a,i[k+1])||o(a,i[k-1]))&&(y[m]=k,h[m++]=c)}while(m)}function u(){B||(n(),B=5),paused||requestAnimationFrame(u),B--}for(var s=84,v=68,l=[],b=v-1;b>=0;b--){l[b]=[];for(var F=s-1;F>=0;F--)l[b][F]=new Int32Array(5)}var k=document.getElementById("PartLayer"),p=k.getContext("2d"),w=["#000000","#444466","#FFFFCC","#AAAAAA","#805050","#505080","#003000","#20CC20","#108010","#554040","#40403C","#858505","#FFC000","#FFFFFF","#DCAD2C"],y=1,d=2,h=3,m=4,A=5,C=6,_=7,g=8,M=9,S=10,x=11,D=12,I=13,L=14,P=[0,1,0,0,1,1,0,1,0,1,0,0,0,0,1],q=[0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],B=0;i(),window.run_frame=n,window.simLoopFn=u,window.clickPixel=e}();