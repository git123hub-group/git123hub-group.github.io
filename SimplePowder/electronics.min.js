var part_state=1,paused=!0;!function(){function e(e,t){e>=82&&(e=81),t>=66&&(t=65);var n=l[t+1][e+1];if(part_state!==d)part_state?l[t+1][e+1][0]||(n[0]=part_state,n[1]=0,n[3]=0,a(e+1,t+1,n)):(n[0]=0,a(e+1,t+1,n));else{if(ctype=n[0],!n[1]&&ctype===M)return c(e+1,t+1,ctype),i();r(e+1,t+1,n),a(e+1,t+1,n)}}function r(e,r,a,i){ctype=a[0],q[ctype]&&a[1]<=0&&(a[2]=ctype,a[0]=d,a[1]=4)}function a(e,r,a){var i;w.fillStyle=p[a[0]],a[0]===I&&a[1]&&(5!==a[2]?w.fillStyle="rgb("+(i=15.95*a[1]|0)+","+i+","+i+")":w.fillStyle="rgb("+(i=100*a[1]|0)+","+3*i/5+","+i/5+")"),w.fillRect(10*(e-1),10*(r-1),10,10)}function i(){for(var e=1;67>e;e++)for(var r=1;83>r;r++)a(r,e,l[e][r])}function t(){for(var e,r,a,t=0;v>t;t++){e=4*t*u;for(var n=0;u>n;n++){if((a=l[t][n])[1])switch(a[1]--,a[0]){case I:a[1]||(a[0]=0)}switch(a[0]){case _:5==a[3]&&(a[0]=g,a[1]=4,a[2]=C),a[3]=0;break;case C:5==a[3]&&(a[0]=g,a[1]=4,a[2]=_),a[3]=0;break;case P:a[1]=a[2],a[2]=0}}}for(r=0;v>r;r++)l[r][0][0]=0,l[r][u-1][0]=0;for(r=0;u>r;r++)l[0][r][0]=0,l[v-1][r][0]=0;for(var t=0;v>t;t++){a=l[t];for(var n=0;u>n;n++)f(n,t,a[n])}i()}function n(e,r){return e>=0&&u>e&&r>=0&&v>r}function f(e,a,i){var t,f,o,s,b,F,k,w,p,E,R,j,z,G,H,J,K=i[0],N=Math.min(2,e),O=Math.min(2,a),Q=Math.min(2,u-e-3),T=Math.min(2,v-a-3);switch(K){case d:if(!i[1])return i[1]=4,void(i[0]=i[2]);if(i[1]>=4)return;for(var U=-O;T>=U;U++){k=l[f=a+U];for(var V=-N;Q>=V;V++)if(!((V>0?V:-V)+(U>0?U:-U)>=4)){switch(w=k[t=e+V],p=i[2],E=w[0],p){case _:(E===y||E===_)&&r(t,f,w);continue;case D:(E===D||E===m||E===A)&&r(t,f,w);continue;case M:E===A&&r(t,f,w);continue}switch(E){case d:switch(w[2]){case _:p===A&&(w[0]=g,w[1]=5,w[2]=C)}continue;case m:if(p===A)continue;break;case C:p===m&&(w[0]=g,w[1]=5,w[2]=_);break;case _:if(p!==y){p===A&&(w[0]=g,w[1]=5,w[2]=C);continue}break;case g:w[2]===_&&w[1]<5&&(p===y?(w[0]=d,w[1]=4):p===A&&(w[1]=5,w[2]=C));continue;case D:(p===m||p===A)&&r(t,f,w);continue;case M:p===m&&c(t,f,E);continue}l[a+f>>1][e+t>>1][0]!==h&&r(t,f,w)}}break;case g:if(i[1]<=0)return void(i[0]=i[2]);if(i[1]>1&&i[1]<5)for(var U=-O;T>=U;U++){k=l[a+U];for(var V=-N;Q>=V;V++)(V>0?V:-V)+(U>0?U:-U)>=4||(w=k[t=e+V],(B[w[0]]||w[0]===d&&B[w[2]]||w[0]===g&&w[2]==_&&i[2]==C)&&(w[2]=i[2],w[0]=g,w[1]=5))}break;case S:for(var U=-O;T>=U;U++){k=l[f=a+U];for(var V=-N;Q>=V;V++)(V>0?V:-V)+(U>0?U:-U)>=4||(w=k[t=e+V],l[a+f>>1][e+t>>1][0]!==h&&w[0]!==D&&r(t=e+V,f,w))}break;case x:b=-4;for(var U=-1;2>U;U++){k=l[f=a+U];for(var V=-1;2>V;V++,b++)if(w=k[t=e+V],w[0]===d&&3===w[1]&&b)for(F=0>b?-b:b,R=-V,j=-U,z=e+R,G=a+j,H=w[2]===M,J=w[2]===m;n(z,G);){if(o=(s=l[G][z])[0])if(s[0]==P)s[2]=1;else{if(J){if(B[s[0]]&&(s[3]|=1<<F-1),s[0]===D||s[0]===d&&s[2]===D||s[0]===x||s[0]===_||s[0]===g&&s[2]===_){z+=R,G+=j;continue}if(s[0]===I){s[1]=1,s[2]=5,z+=R,G+=j;continue}break}if(s[0]===D||s[0]===d&&s[2]===D||s[0]===x||s[0]===_||s[0]===g&&s[2]===_){z+=R,G+=j;continue}if(s[0]===I){if(s[1]){if(s[2]===F){s[1]=16,z+=R,G+=j;continue}5!==s[2]&&(s[1]=0);break}z+=R,G+=j;continue}if(r(z,G,s),!H||s[0]!==d||!q[s[2]])break}else s[0]=I,s[1]=J?2:16,s[2]=J?5:F;z+=R,G+=j}}break;case L:if(!i[1])for(var W=[-4,4,0,0],X=[0,0,-4,4],Y=0;4>Y;Y++)V=W[Y],U=X[Y],n(e+V,a+U)&&(w=l[a+U][e+V])[0]==d&&w[1]<4&&r(e,a,i);break;case P:if(i[1])for(var U=-O;T>=U;U++){k=l[f=a+U];for(var V=-N;Q>=V;V++)(V>0?V:-V)+(U>0?U:-U)>=4||(w=k[t=e+V],r(t,f,w))}}}function o(e,r){return r[0]===e||r[0]===d&&r[2]===e}function c(e,r,a){if(l[r][e][1])return 0;var i,t,n,f,c,s,v,b,F,k,w,p,y=[e],h=[r],m=1;do{for(w=p=e=y[--m],r=h[m],F=l[r];(v=w-1)>=0&&F[v][0]===a&&!F[v][1];)w=v;for(;(b=p+1)<u&&F[b][0]===a&&!F[b][1];)p=b;for(k=w;p>=k;k++)F[k][0]=d,F[k][1]=4,F[k][2]=a;if(f=r-1,i=l[f],c=r+1,t=l[c],w===p&&o(a,i[e-1])&&o(a,i[e+1])&&o(a,i[e])&&o(a,(n=l[s=r-2])[e])&&!o(a,n[e-1])&&!o(a,n[e+1]))n[e][0]!==a||n[e][1]||(y[m]=e,h[m++]=s);else for(k=w;p>=k;k++)i[k][0]!==a||i[k][1]||(k===w||k===p||!o(a,t[k])||o(a,t[k+1])||o(a,t[k-1]))&&(y[m]=k,h[m++]=f);if(w===p&&o(a,t[e-1])&&o(a,t[e+1])&&o(a,t[e])&&o(a,(n=l[s=r+2])[e])&&!o(a,n[e-1])&&!o(a,n[e+1]))n[e][0]!==a||n[e][1]||(y[m]=e,h[m++]=s);else for(k=w;p>=k;k++)t[k][0]!==a||t[k][1]||(k===w||k===p||!o(a,i[k])||o(a,i[k+1])||o(a,i[k-1]))&&(y[m]=k,h[m++]=c)}while(m)}function s(){E||(t(),E=5),paused||requestAnimationFrame(s),E--}for(var u=84,v=68,l=[],b=v-1;b>=0;b--){l[b]=[];for(var F=u-1;F>=0;F--)l[b][F]=new Int32Array(5)}var k=document.getElementById("PartLayer"),w=k.getContext("2d"),p=["#000000","#444466","#FFFFCC","#AAAAAA","#805050","#505080","#003000","#20CC20","#108010","#554040","#40403C","#858505","#FFC000","#FFFFFF","#DCAD2C","#FD9D18"],y=1,d=2,h=3,m=4,A=5,C=6,_=7,g=8,D=9,M=10,S=11,x=12,I=13,L=14,P=15,q=[0,1,0,0,1,1,0,1,0,1,0,0,0,0,1,0],B=[0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0],E=0;i(),window.run_frame=t,window.simLoopFn=s,window.clickPixel=e}();